<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>MiXiM: Mac80211 Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>


</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">MiXiM
   &#160;<span id="projectnumber">2.3</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.5.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('a00128.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-types">Protected Types</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="#pri-methods">Private Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">Mac80211 Class Reference<div class="ingroups"><a class="el" href="a00509.html">macLayer - MAC layer modules</a> &#124; <a class="el" href="a00522.html">IEEE 802.11 - Classes for the IEEE 802.11 implementation of MiXiM</a></div></div>  </div>
</div>
<div class="contents">
<!-- doxytag: class="Mac80211" --><!-- doxytag: inherits="BaseMacLayer" -->
<p>An implementation of the 802.11b MAC.  
 <a href="a00128.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="a00434_source.html">Mac80211.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for Mac80211:</div>
<div class="dyncontent">
<div class="center"><img src="a00832.png" border="0" usemap="#Mac80211_inherit__map" alt="Inheritance graph"/></div>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for Mac80211:</div>
<div class="dyncontent">
<div class="center"><img src="a00833.png" border="0" usemap="#Mac80211_coll__map" alt="Collaboration graph"/></div>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="a00834.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00154.html">NeighborEntry</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Data about a neighbor host.  <a href="a00154.html#details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#ae423db101e8431b0cbd67c347076c44a">Mac80211MessageKinds</a> { <br/>
&#160;&#160;<b>RTS</b> =  LAST_BASE_MAC_MESSAGE_KIND, 
<b>CTS</b>, 
<b>ACK</b>, 
<b>DATA</b>, 
<br/>
&#160;&#160;<b>BROADCAST</b>, 
<b>LAST_MAC_80211_MESSAGE_KIND</b>
<br/>
 }</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">frame kinds <br/></td></tr>
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#ab81dae24d79c2ef010301e2c219966c1">initialize</a> (int)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialization of the module and some variables.  <a href="#ab81dae24d79c2ef010301e2c219966c1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2f3c51473a890e1c3e3afb5dc1b75252"></a><!-- doxytag: member="Mac80211::finish" ref="a2f3c51473a890e1c3e3afb5dc1b75252" args="()" -->
virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a2f3c51473a890e1c3e3afb5dc1b75252">finish</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Called when the simulation has finished. <br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-types"></a>
Protected Types</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a381307739876ed0d015352b95bd93186">timerType</a> { <b>TIMEOUT</b>, 
<b>NAV</b>
 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a7ff0b8b49d1a93feae6f808caf5fe447">State</a> { <br/>
&#160;&#160;<b>WFDATA</b> =  0, 
<b>QUIET</b> =  1, 
<b>IDLE</b> =  2, 
<b>CONTEND</b> =  3, 
<br/>
&#160;&#160;<b>WFCTS</b> =  4, 
<b>WFACK</b> =  5, 
<b>BUSY</b> =  6
<br/>
 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a565ab82077f95d80ec44a4a4fed08ab9"></a><!-- doxytag: member="Mac80211::MacPktList" ref="a565ab82077f95d80ec44a4a4fed08ab9" args="" -->
typedef std::list&lt; Mac80211Pkt * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a565ab82077f95d80ec44a4a4fed08ab9">MacPktList</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Type for a queue of Mac80211Pkts. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a072f068412a3577d8d11ca98c52a9c48"></a><!-- doxytag: member="Mac80211::NeighborList" ref="a072f068412a3577d8d11ca98c52a9c48" args="" -->
typedef std::list&lt; <a class="el" href="a00154.html">NeighborEntry</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a072f068412a3577d8d11ca98c52a9c48">NeighborList</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Type for a list of NeighborEntries. <br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a990af33f857669759da0cbeebd1c2431">handleSelfMsg</a> (cMessage *)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle self messages such as timer...  <a href="#a990af33f857669759da0cbeebd1c2431"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#af7e230f8713536482417699f2f6bee71">handleUpperMsg</a> (cMessage *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle messages from upper layer.  <a href="#af7e230f8713536482417699f2f6bee71"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#ac8bfb04590aab2434bd8d17ee4e213d9">handleLowerMsg</a> (cMessage *)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle messages from lower layer.  <a href="#ac8bfb04590aab2434bd8d17ee4e213d9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a41f1a7b86f420e1f840c14badf2b0890"></a><!-- doxytag: member="Mac80211::handleLowerControl" ref="a41f1a7b86f420e1f840c14badf2b0890" args="(cMessage *)" -->
virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a41f1a7b86f420e1f840c14badf2b0890">handleLowerControl</a> (cMessage *)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle messages from lower layer. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a0a87fa1791117ef1dd1841ba217e4245">handleEndContentionTimer</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">handle end of contention  <a href="#a0a87fa1791117ef1dd1841ba217e4245"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a0377ddefba33b8d50c7bf4045354d7bb">handleMsgNotForMe</a> (cMessage *af, simtime_t_cref duration)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">handle a message that is not for me or errornous  <a href="#a0377ddefba33b8d50c7bf4045354d7bb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#aa0b767642d86d3b66f1d3258065fe5ae">handleMsgForMe</a> (Mac80211Pkt *)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">handle a message that was meant for me  <a href="#aa0b767642d86d3b66f1d3258065fe5ae"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#adfcf8b7a5e1db233a1bd717cecaf49bd">handleBroadcastMsg</a> (Mac80211Pkt *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#afe4300147d9ea5e4d3e3d8c98ff20436">handleEndTransmission</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">handle the end of a transmission...  <a href="#afe4300147d9ea5e4d3e3d8c98ff20436"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a7d36a55827a7ea91b2539c86d79349af">handleEndSifsTimer</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">handle end of SIFS  <a href="#a7d36a55827a7ea91b2539c86d79349af"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#ab5fcba8c7a3878ac59195a483ba35a12">handleTimeoutTimer</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">handle time out  <a href="#ab5fcba8c7a3878ac59195a483ba35a12"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a23a142d65d7a0dcba4a60c0f509ab5b9">handleNavTimer</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">NAV timer expired, the exchange of messages of other stations is done.  <a href="#a23a142d65d7a0dcba4a60c0f509ab5b9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a98ad0d3935d620b33302e5230b395685">handleRTSframe</a> (Mac80211Pkt *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#ab0844f9dbcece750c9a58ca9f0a73fe1">handleDATAframe</a> (Mac80211Pkt *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a50cb85360462eb7d256ec8a0b493ca44">handleACKframe</a> (Mac80211Pkt *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#ae1e17af7dddc261d7947d48a1f4d0e21">handleCTSframe</a> (Mac80211Pkt *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa70252cee19dfda74662f06075ee52bf"></a><!-- doxytag: member="Mac80211::dataTransmissionFailed" ref="aa70252cee19dfda74662f06075ee52bf" args="()" -->
void&#160;</td><td class="memItemRight" valign="bottom"><b>dataTransmissionFailed</b> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad44649781514babc1a180bf5c82be983"></a><!-- doxytag: member="Mac80211::rtsTransmissionFailed" ref="ad44649781514babc1a180bf5c82be983" args="()" -->
void&#160;</td><td class="memItemRight" valign="bottom"><b>rtsTransmissionFailed</b> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a7a4ff22b4b999827a898794923115880">sendDATAframe</a> (Mac80211Pkt *)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">send data frame  <a href="#a7a4ff22b4b999827a898794923115880"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a1c404a5176db493c2fefb71537783607">sendACKframe</a> (Mac80211Pkt *)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">send Acknoledgement  <a href="#a1c404a5176db493c2fefb71537783607"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a1fd59a589e53facb68c13be84521a49e">sendCTSframe</a> (Mac80211Pkt *)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">send CTS frame  <a href="#a1fd59a589e53facb68c13be84521a49e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a3104750758ab171b20ffcfeae0079a78">sendRTSframe</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">send RTS frame  <a href="#a3104750758ab171b20ffcfeae0079a78"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a26b30d048980b56d79c04e859bfce009">sendBROADCASTframe</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">send broadcast frame  <a href="#a26b30d048980b56d79c04e859bfce009"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual macpkt_ptr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a23738e3ef2aa14da9dbdcb3d0abbf4e2">encapsMsg</a> (cPacket *netw)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">encapsulate packet  <a href="#a23738e3ef2aa14da9dbdcb3d0abbf4e2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9c6a33b29ff6e1500947fd6ca221b13e"></a><!-- doxytag: member="Mac80211::decapsMsg" ref="a9c6a33b29ff6e1500947fd6ca221b13e" args="(macpkt_ptr_t frame)" -->
virtual cPacket *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a9c6a33b29ff6e1500947fd6ca221b13e">decapsMsg</a> (macpkt_ptr_t frame)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">decapsulate packet <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#ab3030c86acac78401f877a61cefcdad6">beginNewCycle</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">start a new contention period  <a href="#ab3030c86acac78401f877a61cefcdad6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#ade2c913df312fd4fc46106c1134889b8">backoff</a> (bool rtscts=true)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute a backoff value.  <a href="#ade2c913df312fd4fc46106c1134889b8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a72e78257babff863ca8749b2bb1a97f4">testMaxAttempts</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Test if maximum number of retries to transmit is exceeded.  <a href="#a72e78257babff863ca8749b2bb1a97f4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a424851e88bb229fcc3c59cfea80a9079">timeOut</a> (<a class="el" href="a00128.html#ae423db101e8431b0cbd67c347076c44a">Mac80211MessageKinds</a> type, double br)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">return a timeOut value for a certain type of frame  <a href="#a424851e88bb229fcc3c59cfea80a9079"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a6732e4a776e78432bf5dd9dd26de2f7d">packetDuration</a> (double bits, double br)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">computes the duration of a transmission over the physical channel, given a certain bitrate  <a href="#a6732e4a776e78432bf5dd9dd26de2f7d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ade8a90e665191333e610b60bad4a32a1"></a><!-- doxytag: member="Mac80211::stateName" ref="ade8a90e665191333e610b60bad4a32a1" args="(State state)" -->
const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#ade8a90e665191333e610b60bad4a32a1">stateName</a> (<a class="el" href="a00128.html#a7ff0b8b49d1a93feae6f808caf5fe447">State</a> <a class="el" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c">state</a>)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Produce a readable name of the given state. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9fc6eb078e53740d354f8ea7b9d94713"></a><!-- doxytag: member="Mac80211::setState" ref="a9fc6eb078e53740d354f8ea7b9d94713" args="(State state)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a9fc6eb078e53740d354f8ea7b9d94713">setState</a> (<a class="el" href="a00128.html#a7ff0b8b49d1a93feae6f808caf5fe447">State</a> <a class="el" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c">state</a>)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the state, and produces a log message in between. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa316943080d714ffc3c0bf54ea8aeb08"></a><!-- doxytag: member="Mac80211::rtsCts" ref="aa316943080d714ffc3c0bf54ea8aeb08" args="(Mac80211Pkt *m)" -->
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#aa316943080d714ffc3c0bf54ea8aeb08">rtsCts</a> (Mac80211Pkt *m)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Check whether the next packet should be send with RTS/CTS. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9ae0815a0e01c4d4fd13a87393f837a8"></a><!-- doxytag: member="Mac80211::suspendContention" ref="a9ae0815a0e01c4d4fd13a87393f837a8" args="()" -->
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a9ae0815a0e01c4d4fd13a87393f837a8">suspendContention</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">suspend an ongoing contention, pick it up again when the channel becomes idle <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7905be98b60b2a709dfbcd7e16bc761e"></a><!-- doxytag: member="Mac80211::retrieveBitrate" ref="a7905be98b60b2a709dfbcd7e16bc761e" args="(const LAddress::L2Type &amp;destAddress)" -->
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a7905be98b60b2a709dfbcd7e16bc761e">retrieveBitrate</a> (const <a class="el" href="a00117.html#aea56b60dcb5ae8c2bde465271daf7210">LAddress::L2Type</a> &amp;destAddress)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">figure out at which bitrate to send to this particular destination <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8dd543a1a0b89f98af6d39d28dbd9e74"></a><!-- doxytag: member="Mac80211::addNeighbor" ref="a8dd543a1a0b89f98af6d39d28dbd9e74" args="(Mac80211Pkt *af)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a8dd543a1a0b89f98af6d39d28dbd9e74">addNeighbor</a> (Mac80211Pkt *af)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">add a new entry to the neighbor list <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aaf9d15b3d9055b2f56d4eddce7cc9850"></a><!-- doxytag: member="Mac80211::findNeighbor" ref="aaf9d15b3d9055b2f56d4eddce7cc9850" args="(const LAddress::L2Type &amp;address)" -->
NeighborList::iterator&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#aaf9d15b3d9055b2f56d4eddce7cc9850">findNeighbor</a> (const <a class="el" href="a00117.html#aea56b60dcb5ae8c2bde465271daf7210">LAddress::L2Type</a> &amp;address)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">find a neighbor based on his address <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a967bb2466f35274cc945db0d9e044eeb"></a><!-- doxytag: member="Mac80211::findOldestNeighbor" ref="a967bb2466f35274cc945db0d9e044eeb" args="()" -->
NeighborList::iterator&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a967bb2466f35274cc945db0d9e044eeb">findOldestNeighbor</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">find the oldest neighbor -- usually in order to overwrite this entry <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a59cb9e6071f33bc460a2f3a662c4bc59">senseChannelWhileIdle</a> (simtime_t_cref duration)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Starts a channel sense request which sense the channel for the passed duration or until the channel is busy.  <a href="#a59cb9e6071f33bc460a2f3a662c4bc59"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3a62f334346a15619853a8c6c87367aa"></a><!-- doxytag: member="Mac80211::createSignal" ref="a3a62f334346a15619853a8c6c87367aa" args="(simtime_t_cref start, simtime_t_cref length, double power, double bitrate)" -->
<a class="el" href="a00192.html">Signal</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a3a62f334346a15619853a8c6c87367aa">createSignal</a> (simtime_t_cref start, simtime_t_cref length, double power, double <a class="el" href="a00128.html#a126c9db5a54bafa6ad74eb3ee24bd936">bitrate</a>)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates the signal to be used for a packet to be sent. <br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2d31f97b0662b8e37f090c3b996cec82"></a><!-- doxytag: member="Mac80211::timeout" ref="a2d31f97b0662b8e37f090c3b996cec82" args="" -->
cMessage *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a2d31f97b0662b8e37f090c3b996cec82">timeout</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a35efb0198d0085a341aba515bec9146f"></a><!-- doxytag: member="Mac80211::nav" ref="a35efb0198d0085a341aba515bec9146f" args="" -->
cMessage *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a35efb0198d0085a341aba515bec9146f">nav</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Timer used for the defer time of a node. Also called NAV : networks allocation vector. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7bd4f3adc205b150f9fa406fa582f0b6"></a><!-- doxytag: member="Mac80211::contention" ref="a7bd4f3adc205b150f9fa406fa582f0b6" args="" -->
ChannelSenseRequest *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a7bd4f3adc205b150f9fa406fa582f0b6">contention</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Used to sense if the channel is idle for contention periods. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ace80836b6fcb1681f6b2d49466f87fb0"></a><!-- doxytag: member="Mac80211::endSifs" ref="ace80836b6fcb1681f6b2d49466f87fb0" args="" -->
ChannelSenseRequest *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#ace80836b6fcb1681f6b2d49466f87fb0">endSifs</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Timer used to indicate the end of a SIFS. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8104daf3041394b73fe545427cbc02d7"></a><!-- doxytag: member="Mac80211::chSenseStart" ref="a8104daf3041394b73fe545427cbc02d7" args="" -->
simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a8104daf3041394b73fe545427cbc02d7">chSenseStart</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Stores the the time a channel sensing started. Used to calculate the quiet-time of the channel if the sensing was aborted. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a56fa75f3eb056ae29b1a4b8da0035d8c"></a><!-- doxytag: member="Mac80211::state" ref="a56fa75f3eb056ae29b1a4b8da0035d8c" args="" -->
<a class="el" href="a00128.html#a7ff0b8b49d1a93feae6f808caf5fe447">State</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c">state</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Current state of the MAC. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a226566e4a56cfed2928acc87ff3af90a">defaultBitrate</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Default bitrate.  <a href="#a226566e4a56cfed2928acc87ff3af90a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a592eee2a24a6fcadd6fdf912a101719f"></a><!-- doxytag: member="Mac80211::txPower" ref="a592eee2a24a6fcadd6fdf912a101719f" args="" -->
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a592eee2a24a6fcadd6fdf912a101719f">txPower</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The power at which data is transmitted. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a67eba657efe23f5e5c21904f4744261d"></a><!-- doxytag: member="Mac80211::centerFreq" ref="a67eba657efe23f5e5c21904f4744261d" args="" -->
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a67eba657efe23f5e5c21904f4744261d">centerFreq</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Stores the center frequency the Mac uses. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a126c9db5a54bafa6ad74eb3ee24bd936"></a><!-- doxytag: member="Mac80211::bitrate" ref="a126c9db5a54bafa6ad74eb3ee24bd936" args="" -->
double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a126c9db5a54bafa6ad74eb3ee24bd936">bitrate</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Current bit rate at which data is transmitted. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a979883a8da4b308de4a8e79b5bbbe2e6"></a><!-- doxytag: member="Mac80211::autoBitrate" ref="a979883a8da4b308de4a8e79b5bbbe2e6" args="" -->
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a979883a8da4b308de4a8e79b5bbbe2e6">autoBitrate</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Auto bit rate adaptation -- switch. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1cd38454a518f922ba57f68d22e2f31e"></a><!-- doxytag: member="Mac80211::snrThresholds" ref="a1cd38454a518f922ba57f68d22e2f31e" args="" -->
std::vector&lt; double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a1cd38454a518f922ba57f68d22e2f31e">snrThresholds</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Hold RSSI thresholds at which to change the bitrates. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae8892c105c3f0fb2b6f28634bb099f31"></a><!-- doxytag: member="Mac80211::queueLength" ref="ae8892c105c3f0fb2b6f28634bb099f31" args="" -->
unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#ae8892c105c3f0fb2b6f28634bb099f31">queueLength</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximal number of packets in the queue; should be set in the omnetpp.ini. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5d8e9b53c8d6cb0116feed506d843e18"></a><!-- doxytag: member="Mac80211::nextIsBroadcast" ref="a5d8e9b53c8d6cb0116feed506d843e18" args="" -->
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a5d8e9b53c8d6cb0116feed506d843e18">nextIsBroadcast</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Boolean used to know if the next packet is a broadcast packet. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a969e8e3a592dffccea28596c61b2af50"></a><!-- doxytag: member="Mac80211::fromUpperLayer" ref="a969e8e3a592dffccea28596c61b2af50" args="" -->
<a class="el" href="a00128.html#a565ab82077f95d80ec44a4a4fed08ab9">MacPktList</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a969e8e3a592dffccea28596c61b2af50">fromUpperLayer</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Buffering of messages from upper layer. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a11fb608b3564e2d2cd41b463b1a8cc90">longRetryCounter</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of frame transmission attempt.  <a href="#a11fb608b3564e2d2cd41b463b1a8cc90"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9bbc3d71eddb62c4e12dcd500a58b0bb"></a><!-- doxytag: member="Mac80211::shortRetryCounter" ref="a9bbc3d71eddb62c4e12dcd500a58b0bb" args="" -->
unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a9bbc3d71eddb62c4e12dcd500a58b0bb">shortRetryCounter</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of frame transmission attempt. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a58484d1a6f2031548d433d18438042e9"></a><!-- doxytag: member="Mac80211::remainingBackoff" ref="a58484d1a6f2031548d433d18438042e9" args="" -->
simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a58484d1a6f2031548d433d18438042e9">remainingBackoff</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">remaining backoff time. If the backoff timer is interrupted, this variable holds the remaining backoff time. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4a9d1c8d45c46f18afa0f07f5b6572f4"></a><!-- doxytag: member="Mac80211::currentIFS" ref="a4a9d1c8d45c46f18afa0f07f5b6572f4" args="" -->
simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a4a9d1c8d45c46f18afa0f07f5b6572f4">currentIFS</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">current IFS value (DIFS or EIFS) If an error has been detected, the next backoff requires EIFS, once a valid frame has been received, resets to DIFS. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6ad4dd93415c98c969df05f53d739cfd"></a><!-- doxytag: member="Mac80211::rtsCtsThreshold" ref="a6ad4dd93415c98c969df05f53d739cfd" args="" -->
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a6ad4dd93415c98c969df05f53d739cfd">rtsCtsThreshold</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of bits in a packet before RTS/CTS is used. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab9f0ea820748af6d640569fc76f39659"></a><!-- doxytag: member="Mac80211::delta" ref="ab9f0ea820748af6d640569fc76f39659" args="" -->
simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#ab9f0ea820748af6d640569fc76f39659">delta</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Very small value used in timer scheduling in order to avoid multiple changements of state in the same simulation time. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae62ff2c9617e5782f6f7231e36d1574d"></a><!-- doxytag: member="Mac80211::neighborhoodCacheSize" ref="ae62ff2c9617e5782f6f7231e36d1574d" args="" -->
unsigned&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#ae62ff2c9617e5782f6f7231e36d1574d">neighborhoodCacheSize</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Keep information for this many neighbors. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aede2e9e4e32ef871e3a59c51564123de"></a><!-- doxytag: member="Mac80211::neighborhoodCacheMaxAge" ref="aede2e9e4e32ef871e3a59c51564123de" args="" -->
simtime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#aede2e9e4e32ef871e3a59c51564123de">neighborhoodCacheMaxAge</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Consider information in cache outdate if it is older than this. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4caf1f3c2c004851555c9c691b82edf9"></a><!-- doxytag: member="Mac80211::neighbors" ref="a4caf1f3c2c004851555c9c691b82edf9" args="" -->
<a class="el" href="a00128.html#a072f068412a3577d8d11ca98c52a9c48">NeighborList</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a4caf1f3c2c004851555c9c691b82edf9">neighbors</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">A list of this hosts neighbors. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a9f9f566e85a76f63e63b5907bf9ad48a">switching</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#a026837b7167d230bbe79a1e0630c7578">fsc</a></td></tr>
<tr><td colspan="2"><h2><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae2d989af4eab21c27e527f80192a27ba"></a><!-- doxytag: member="Mac80211::Mac80211" ref="ae2d989af4eab21c27e527f80192a27ba" args="(const Mac80211 &amp;)" -->
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#ae2d989af4eab21c27e527f80192a27ba">Mac80211</a> (const <a class="el" href="a00128.html">Mac80211</a> &amp;)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Copy constructor is not allowed. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aab98ee4e3ed888adc56f387a3cdc9138"></a><!-- doxytag: member="Mac80211::operator=" ref="aab98ee4e3ed888adc56f387a3cdc9138" args="(const Mac80211 &amp;)" -->
<a class="el" href="a00128.html">Mac80211</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00128.html#aab98ee4e3ed888adc56f387a3cdc9138">operator=</a> (const <a class="el" href="a00128.html">Mac80211</a> &amp;)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Assignment operator is not allowed. <br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>An implementation of the 802.11b MAC. </p>
<p>For more info, see the NED file.</p>
<dl class="author"><dt><b>Author:</b></dt><dd>David Raguin, Karl Wessel (port for MiXiM) </dd></dl>
</div><hr/><h2>Member Enumeration Documentation</h2>
<a class="anchor" id="a7ff0b8b49d1a93feae6f808caf5fe447"></a><!-- doxytag: member="Mac80211::State" ref="a7ff0b8b49d1a93feae6f808caf5fe447" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="a00128.html#a7ff0b8b49d1a93feae6f808caf5fe447">Mac80211::State</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Definition of the states </p>
<div class="fragment"><pre class="fragment">               {
      WFDATA = 0, <span class="comment">// waiting for data packet</span>
      QUIET = 1,  <span class="comment">// waiting for the communication between two other nodes to end</span>
      IDLE = 2,   <span class="comment">// no packet to send, no packet receiving</span>
      CONTEND = 3,<span class="comment">// contention state (battle for the channel)</span>
      WFCTS = 4,  <span class="comment">// RTS sent, waiting for CTS</span>
      WFACK = 5,  <span class="comment">// DATA packet sent, waiting for ACK</span>
      BUSY = 6    <span class="comment">// during transmission of an ACK or a BROADCAST packet</span>
    };
</pre></div>
</div>
</div>
<a class="anchor" id="a381307739876ed0d015352b95bd93186"></a><!-- doxytag: member="Mac80211::timerType" ref="a381307739876ed0d015352b95bd93186" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="a00128.html#a381307739876ed0d015352b95bd93186">Mac80211::timerType</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Definition of the timer types </p>
<div class="fragment"><pre class="fragment">                   {
      TIMEOUT,
      NAV
    };
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="ade2c913df312fd4fc46106c1134889b8"></a><!-- doxytag: member="Mac80211::backoff" ref="ade2c913df312fd4fc46106c1134889b8" args="(bool rtscts=true)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t Mac80211::backoff </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>rtscts</em> = <code>true</code></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Compute a backoff value. </p>
<p>Compute the backoff value. </p>

<p>References <a class="el" href="a00128.html#a11fb608b3564e2d2cd41b463b1a8cc90">longRetryCounter</a>, and <a class="el" href="a00128.html#a9bbc3d71eddb62c4e12dcd500a58b0bb">shortRetryCounter</a>.</p>

<p>Referenced by <a class="el" href="a00128.html#ab3030c86acac78401f877a61cefcdad6">beginNewCycle()</a>, <a class="el" href="a00128.html#a50cb85360462eb7d256ec8a0b493ca44">handleACKframe()</a>, <a class="el" href="a00128.html#afe4300147d9ea5e4d3e3d8c98ff20436">handleEndTransmission()</a>, and <a class="el" href="a00128.html#ab81dae24d79c2ef010301e2c219966c1">initialize()</a>.</p>
<div class="fragment"><pre class="fragment">                                       {
    <span class="keywordtype">unsigned</span> rc = (rtscts) ?  <a class="code" href="a00128.html#a11fb608b3564e2d2cd41b463b1a8cc90" title="Number of frame transmission attempt.">longRetryCounter</a> : <a class="code" href="a00128.html#a9bbc3d71eddb62c4e12dcd500a58b0bb" title="Number of frame transmission attempt.">shortRetryCounter</a>;
    <span class="keywordtype">unsigned</span> cw = ((CW_MIN + 1) &lt;&lt; rc) - 1;
    <span class="keywordflow">if</span>(cw &gt; CW_MAX) cw = CW_MAX;

    simtime_t value = ((double) intrand(cw + 1)) * ST;
    debugEV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; random backoff = &quot;</span> &lt;&lt; value &lt;&lt; endl;

    <span class="keywordflow">return</span> value;
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab3030c86acac78401f877a61cefcdad6"></a><!-- doxytag: member="Mac80211::beginNewCycle" ref="ab3030c86acac78401f877a61cefcdad6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::beginNewCycle </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>start a new contention period </p>
<p>Start a new contention period if the channel is free and if there's a packet to send. Called at the end of a deferring period, a busy period, or after a failure. Called by the HandleMsgForMe(), HandleTimer() HandleUpperMsg(), and, without RTS/CTS, by <a class="el" href="a00128.html#a0377ddefba33b8d50c7bf4045354d7bb" title="handle a message that is not for me or errornous">handleMsgNotForMe()</a>. </p>

<p>References <a class="el" href="a00128.html#ade2c913df312fd4fc46106c1134889b8">backoff()</a>, <a class="el" href="a00128.html#a7bd4f3adc205b150f9fa406fa582f0b6">contention</a>, <a class="el" href="a00128.html#a4a9d1c8d45c46f18afa0f07f5b6572f4">currentIFS</a>, <a class="el" href="a00128.html#a969e8e3a592dffccea28596c61b2af50">fromUpperLayer</a>, <a class="el" href="a00134.html#affa30a25b96ffe387b22c68ca35f77a5">MacToPhyInterface::getChannelState()</a>, <a class="el" href="a00044.html#aa7125a711299c62119c5fe5bc3f43f1f">ChannelState::info()</a>, <a class="el" href="a00044.html#ab09e4515d5428b1287a62ec1bd1b01fe">ChannelState::isIdle()</a>, <a class="el" href="a00117.html#a3890f1c7314c5695e32252468e6bd5a5">LAddress::isL2Broadcast()</a>, <a class="el" href="a00128.html#a35efb0198d0085a341aba515bec9146f">nav</a>, <a class="el" href="a00128.html#a5d8e9b53c8d6cb0116feed506d843e18">nextIsBroadcast</a>, <a class="el" href="a00026.html#aa7b1e6bdb734765a9f4eff7d486dfbea">BaseMacLayer::phy</a>, <a class="el" href="a00128.html#a58484d1a6f2031548d433d18438042e9">remainingBackoff</a>, <a class="el" href="a00128.html#a59cb9e6071f33bc460a2f3a662c4bc59">senseChannelWhileIdle()</a>, <a class="el" href="a00128.html#a9fc6eb078e53740d354f8ea7b9d94713">setState()</a>, and <a class="el" href="a00128.html#a72e78257babff863ca8749b2bb1a97f4">testMaxAttempts()</a>.</p>

<p>Referenced by <a class="el" href="a00128.html#a50cb85360462eb7d256ec8a0b493ca44">handleACKframe()</a>, <a class="el" href="a00128.html#adfcf8b7a5e1db233a1bd717cecaf49bd">handleBroadcastMsg()</a>, <a class="el" href="a00128.html#afe4300147d9ea5e4d3e3d8c98ff20436">handleEndTransmission()</a>, <a class="el" href="a00128.html#a0377ddefba33b8d50c7bf4045354d7bb">handleMsgNotForMe()</a>, <a class="el" href="a00128.html#a23a142d65d7a0dcba4a60c0f509ab5b9">handleNavTimer()</a>, <a class="el" href="a00128.html#ab5fcba8c7a3878ac59195a483ba35a12">handleTimeoutTimer()</a>, and <a class="el" href="a00128.html#af7e230f8713536482417699f2f6bee71">handleUpperMsg()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// before trying to send one more time a packet, test if the</span>
    <span class="comment">// maximum retry limit is reached. If it is the case, then</span>
    <span class="comment">// delete the packet and send the next packet.</span>
    <a class="code" href="a00128.html#a72e78257babff863ca8749b2bb1a97f4" title="Test if maximum number of retries to transmit is exceeded.">testMaxAttempts</a>();

    <span class="keywordflow">if</span> (<a class="code" href="a00128.html#a35efb0198d0085a341aba515bec9146f" title="Timer used for the defer time of a node. Also called NAV : networks allocation vector.">nav</a>-&gt;isScheduled()) {
      debugEV &lt;&lt; <span class="stringliteral">&quot;cannot beginNewCycle until NAV expires at t &quot;</span> &lt;&lt; <a class="code" href="a00128.html#a35efb0198d0085a341aba515bec9146f" title="Timer used for the defer time of a node. Also called NAV : networks allocation vector.">nav</a>-&gt;getArrivalTime() &lt;&lt; endl;
        <span class="keywordflow">return</span>;
    }

    <span class="comment">/*</span>
<span class="comment">    if(timeout-&gt;isScheduled()) {</span>
<span class="comment">      cancelEvent(timeout);</span>
<span class="comment">    }</span>
<span class="comment">    */</span>

    <span class="keywordflow">if</span> (!<a class="code" href="a00128.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.empty()) {

        <span class="comment">// look if the next packet is unicast or broadcast</span>
        <a class="code" href="a00128.html#a5d8e9b53c8d6cb0116feed506d843e18" title="Boolean used to know if the next packet is a broadcast packet.">nextIsBroadcast</a> = <a class="code" href="a00117.html#a3890f1c7314c5695e32252468e6bd5a5" title="Test if a L2 address (pSrcAddr) is a broadcast address.">LAddress::isL2Broadcast</a>(<a class="code" href="a00128.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.front()-&gt;getDestAddr());

        <a class="code" href="a00128.html#a9fc6eb078e53740d354f8ea7b9d94713" title="Sets the state, and produces a log message in between.">setState</a>(CONTEND);
        <span class="keywordflow">if</span>(!<a class="code" href="a00128.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>-&gt;isScheduled()) {
            <a class="code" href="a00044.html" title="Provides information about the current state of the channel:">ChannelState</a> channel = <a class="code" href="a00026.html#aa7b1e6bdb734765a9f4eff7d486dfbea" title="Handler to the physical layer.">phy</a>-&gt;<a class="code" href="a00134.html#affa30a25b96ffe387b22c68ca35f77a5" title="Returns the current state of the channel. See ChannelState for details.">getChannelState</a>();
            debugEV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; do contention: medium = &quot;</span> &lt;&lt; channel.<a class="code" href="a00044.html#aa7125a711299c62119c5fe5bc3f43f1f" title="Output for this ChannelState.">info</a>() &lt;&lt; <span class="stringliteral">&quot;, backoff = &quot;</span>
               &lt;&lt;  <a class="code" href="a00128.html#a58484d1a6f2031548d433d18438042e9" title="remaining backoff time. If the backoff timer is interrupted, this variable holds the remaining backof...">remainingBackoff</a> &lt;&lt; endl;

            <span class="keywordflow">if</span>(channel.<a class="code" href="a00044.html#ab09e4515d5428b1287a62ec1bd1b01fe" title="Returns true if the channel is considered idle, meaning depends on the used decider.">isIdle</a>()) {
                <a class="code" href="a00128.html#a59cb9e6071f33bc460a2f3a662c4bc59" title="Starts a channel sense request which sense the channel for the passed duration or until the channel i...">senseChannelWhileIdle</a>(<a class="code" href="a00128.html#a4a9d1c8d45c46f18afa0f07f5b6572f4" title="current IFS value (DIFS or EIFS) If an error has been detected, the next backoff requires EIFS...">currentIFS</a> + <a class="code" href="a00128.html#a58484d1a6f2031548d433d18438042e9" title="remaining backoff time. If the backoff timer is interrupted, this variable holds the remaining backof...">remainingBackoff</a>);
                <span class="comment">//scheduleAt(simTime() + currentIFS + remainingBackoff, contention);</span>
            }
            <span class="keywordflow">else</span> {
                <span class="comment">/*</span>
<span class="comment">                Mac80211 in MiXiM uses the same mechanism for backoff and post-backoff, a senseChannelWhileIdle which</span>
<span class="comment">                schedules a timer for a duration of IFS + remainingBackoff (i.e. The inter-frame spacing and the present</span>
<span class="comment">                state of the backoff counter).</span>
<span class="comment"></span>
<span class="comment">                If Host A were doing post-backoff when the frame from Host B arrived, the remainingBackoff would have</span>
<span class="comment">                been &gt; 0 and backoff would have resumed after the frame from Host B finishes.</span>
<span class="comment"></span>
<span class="comment">                However, Host A has already completed its post-backoff (remainingBackoff was 0) so it essentially was</span>
<span class="comment">                IDLE when the beacon was generated (actually, it was receiving Host Bs frame). So what happens now is</span>
<span class="comment">                that all nodes which have an arrival during Host Bs frame AND have completed their post-backoff, will</span>
<span class="comment">                wait one IFS and then transmit, resulting in synchronised collisions one IFS after a transmission (or</span>
<span class="comment">                an EIFS after a collision).</span>
<span class="comment"></span>
<span class="comment">                The correct behaviour here is for Host As MAC to note that post-backoff has completed (remainingBackoff</span>
<span class="comment">                has reached 0) and the medium is busy, so the MAC must draw a new backoff from the contention window.</span>
<span class="comment"></span>
<span class="comment">                http://www.freeminded.org/?p=801</span>
<span class="comment">                */</span>
                <span class="comment">//channel is busy</span>
                <span class="keywordflow">if</span>(<a class="code" href="a00128.html#a58484d1a6f2031548d433d18438042e9" title="remaining backoff time. If the backoff timer is interrupted, this variable holds the remaining backof...">remainingBackoff</a>==0) {
                    <a class="code" href="a00128.html#a58484d1a6f2031548d433d18438042e9" title="remaining backoff time. If the backoff timer is interrupted, this variable holds the remaining backof...">remainingBackoff</a> = <a class="code" href="a00128.html#ade2c913df312fd4fc46106c1134889b8" title="Compute a backoff value.">backoff</a>();
                }
            }
        }
    }
    <span class="keywordflow">else</span> {
        <span class="comment">// post-xmit backoff (minor nit: if random backoff=0, we punt)</span>
        <span class="keywordflow">if</span>(<a class="code" href="a00128.html#a58484d1a6f2031548d433d18438042e9" title="remaining backoff time. If the backoff timer is interrupted, this variable holds the remaining backof...">remainingBackoff</a> &gt; 0 &amp;&amp; !<a class="code" href="a00128.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>-&gt;isScheduled()) {
          <a class="code" href="a00044.html" title="Provides information about the current state of the channel:">ChannelState</a> channel = <a class="code" href="a00026.html#aa7b1e6bdb734765a9f4eff7d486dfbea" title="Handler to the physical layer.">phy</a>-&gt;<a class="code" href="a00134.html#affa30a25b96ffe387b22c68ca35f77a5" title="Returns the current state of the channel. See ChannelState for details.">getChannelState</a>();
          debugEV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; do contention: medium = &quot;</span> &lt;&lt; channel.<a class="code" href="a00044.html#aa7125a711299c62119c5fe5bc3f43f1f" title="Output for this ChannelState.">info</a>() &lt;&lt; <span class="stringliteral">&quot;, backoff = &quot;</span>
               &lt;&lt;  <a class="code" href="a00128.html#a58484d1a6f2031548d433d18438042e9" title="remaining backoff time. If the backoff timer is interrupted, this variable holds the remaining backof...">remainingBackoff</a> &lt;&lt; endl;

            <span class="keywordflow">if</span>(channel.<a class="code" href="a00044.html#ab09e4515d5428b1287a62ec1bd1b01fe" title="Returns true if the channel is considered idle, meaning depends on the used decider.">isIdle</a>()) {
              <a class="code" href="a00128.html#a59cb9e6071f33bc460a2f3a662c4bc59" title="Starts a channel sense request which sense the channel for the passed duration or until the channel i...">senseChannelWhileIdle</a>(<a class="code" href="a00128.html#a4a9d1c8d45c46f18afa0f07f5b6572f4" title="current IFS value (DIFS or EIFS) If an error has been detected, the next backoff requires EIFS...">currentIFS</a> + <a class="code" href="a00128.html#a58484d1a6f2031548d433d18438042e9" title="remaining backoff time. If the backoff timer is interrupted, this variable holds the remaining backof...">remainingBackoff</a>);
                <span class="comment">//scheduleAt(simTime() + currentIFS + remainingBackoff, contention);</span>
            }
        }
        <a class="code" href="a00128.html#a9fc6eb078e53740d354f8ea7b9d94713" title="Sets the state, and produces a log message in between.">setState</a>(IDLE);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a23738e3ef2aa14da9dbdcb3d0abbf4e2"></a><!-- doxytag: member="Mac80211::encapsMsg" ref="a23738e3ef2aa14da9dbdcb3d0abbf4e2" args="(cPacket *netw)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Mac80211::macpkt_ptr_t Mac80211::encapsMsg </td>
          <td>(</td>
          <td class="paramtype">cPacket *&#160;</td>
          <td class="paramname"><em>netw</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>encapsulate packet </p>
<p>Encapsulates the received network-layer packet into a MacPkt and set all needed header fields. </p>

<p>Reimplemented from <a class="el" href="a00026.html#a0e1c8dad62e40f43a43c7b8a0cb71501">BaseMacLayer</a>.</p>

<p>References <a class="el" href="a00128.html#a026837b7167d230bbe79a1e0630c7578">fsc</a>, <a class="el" href="a00026.html#a48135ffa21044a71d92149d5301f9deb">BaseMacLayer::getUpperDestinationFromControlInfo()</a>, and <a class="el" href="a00026.html#a8a26df9da07801d8ccb530530ef57ee2">BaseMacLayer::myMacAddr</a>.</p>

<p>Referenced by <a class="el" href="a00128.html#af7e230f8713536482417699f2f6bee71">handleUpperMsg()</a>.</p>
<div class="fragment"><pre class="fragment">{

    Mac80211Pkt *pkt = <span class="keyword">new</span> Mac80211Pkt(netw-&gt;getName());
    <span class="comment">// headerLength, including final CRC-field AND the phy header length!</span>
    pkt-&gt;setBitLength(MAC80211_HEADER_LENGTH);
    pkt-&gt;setRetry(<span class="keyword">false</span>);                 <span class="comment">// this is not a retry</span>
    pkt-&gt;setSequenceControl(<a class="code" href="a00128.html#a026837b7167d230bbe79a1e0630c7578">fsc</a>++);       <span class="comment">// add a unique fsc to it</span>
    <span class="keywordflow">if</span>(<a class="code" href="a00128.html#a026837b7167d230bbe79a1e0630c7578">fsc</a> &lt;= 0) <a class="code" href="a00128.html#a026837b7167d230bbe79a1e0630c7578">fsc</a> = 1;

    <span class="comment">// copy dest address from the Control Info attached to the network</span>
    <span class="comment">// mesage by the network layer</span>
    cObject *<span class="keyword">const</span> cInfo = netw-&gt;removeControlInfo();

    debugEV &lt;&lt; <span class="stringliteral">&quot;CInfo removed, mac addr=&quot;</span> &lt;&lt; <a class="code" href="a00026.html#a48135ffa21044a71d92149d5301f9deb" title="Extracts the MAC address from the &quot;control info&quot; structure (object).">getUpperDestinationFromControlInfo</a>(cInfo) &lt;&lt; endl;
    pkt-&gt;setDestAddr(<a class="code" href="a00026.html#a48135ffa21044a71d92149d5301f9deb" title="Extracts the MAC address from the &quot;control info&quot; structure (object).">getUpperDestinationFromControlInfo</a>(cInfo));

    <span class="comment">//delete the control info</span>
    <span class="keyword">delete</span> cInfo;

    <span class="comment">//set the src address to own mac address (nic module id())</span>
    pkt-&gt;setSrcAddr(<a class="code" href="a00026.html#a8a26df9da07801d8ccb530530ef57ee2" title="MAC address.">myMacAddr</a>);

    <span class="comment">//encapsulate the network packet</span>
    pkt-&gt;encapsulate(netw);
    debugEV &lt;&lt;<span class="stringliteral">&quot;pkt encapsulated, length: &quot;</span> &lt;&lt; pkt-&gt;getBitLength() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;

    <span class="keywordflow">return</span> pkt;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a50cb85360462eb7d256ec8a0b493ca44"></a><!-- doxytag: member="Mac80211::handleACKframe" ref="a50cb85360462eb7d256ec8a0b493ca44" args="(Mac80211Pkt *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleACKframe </td>
          <td>(</td>
          <td class="paramtype">Mac80211Pkt *&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Handle ACK and delete corresponding packet from queue </p>

<p>References <a class="el" href="a00128.html#ade2c913df312fd4fc46106c1134889b8">backoff()</a>, <a class="el" href="a00128.html#ab3030c86acac78401f877a61cefcdad6">beginNewCycle()</a>, <a class="el" href="a00128.html#a969e8e3a592dffccea28596c61b2af50">fromUpperLayer</a>, <a class="el" href="a00128.html#a11fb608b3564e2d2cd41b463b1a8cc90">longRetryCounter</a>, <a class="el" href="a00128.html#a58484d1a6f2031548d433d18438042e9">remainingBackoff</a>, <a class="el" href="a00128.html#a9bbc3d71eddb62c4e12dcd500a58b0bb">shortRetryCounter</a>, and <a class="el" href="a00128.html#a2d31f97b0662b8e37f090c3b996cec82">timeout</a>.</p>

<p>Referenced by <a class="el" href="a00128.html#aa0b767642d86d3b66f1d3258065fe5ae">handleMsgForMe()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// cancel time-out event</span>
    cancelEvent(<a class="code" href="a00128.html#a2d31f97b0662b8e37f090c3b996cec82" title="Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet.">timeout</a>);

    <span class="comment">// the transmission is acknowledged : initialize long_retry_counter</span>
    <a class="code" href="a00128.html#a11fb608b3564e2d2cd41b463b1a8cc90" title="Number of frame transmission attempt.">longRetryCounter</a> = 0;
    <a class="code" href="a00128.html#a9bbc3d71eddb62c4e12dcd500a58b0bb" title="Number of frame transmission attempt.">shortRetryCounter</a> = 0;
    <span class="comment">// post transmit backoff</span>
    <a class="code" href="a00128.html#a58484d1a6f2031548d433d18438042e9" title="remaining backoff time. If the backoff timer is interrupted, this variable holds the remaining backof...">remainingBackoff</a> = <a class="code" href="a00128.html#ade2c913df312fd4fc46106c1134889b8" title="Compute a backoff value.">backoff</a>();
    <span class="comment">// removes the acknowledged packet from the queue</span>
    Mac80211Pkt *temp = <a class="code" href="a00128.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.front();
    <a class="code" href="a00128.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.pop_front();
    <span class="keyword">delete</span> temp;

    <span class="comment">// if thre&#39;s a packet to send and if the channel is free then start a new contention period</span>
    <a class="code" href="a00128.html#ab3030c86acac78401f877a61cefcdad6" title="start a new contention period">beginNewCycle</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="adfcf8b7a5e1db233a1bd717cecaf49bd"></a><!-- doxytag: member="Mac80211::handleBroadcastMsg" ref="adfcf8b7a5e1db233a1bd717cecaf49bd" args="(Mac80211Pkt *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleBroadcastMsg </td>
          <td>(</td>
          <td class="paramtype">Mac80211Pkt *&#160;</td>
          <td class="paramname"><em>af</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Handle a broadcast packet. This packet is simply passed to the upper layer. No acknowledgement is needed. Called by handleLowerMsg(Mac80211Pkt *af) </p>

<p>References <a class="el" href="a00128.html#ab3030c86acac78401f877a61cefcdad6">beginNewCycle()</a>, <a class="el" href="a00128.html#a7bd4f3adc205b150f9fa406fa582f0b6">contention</a>, <a class="el" href="a00128.html#a9c6a33b29ff6e1500947fd6ca221b13e">decapsMsg()</a>, <a class="el" href="a00025.html#adbf061566606041db811b519f0400ed5">BaseLayer::sendUp()</a>, <a class="el" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c">state</a>, and <a class="el" href="a00128.html#a9f9f566e85a76f63e63b5907bf9ad48a">switching</a>.</p>

<p>Referenced by <a class="el" href="a00128.html#ac8bfb04590aab2434bd8d17ee4e213d9">handleLowerMsg()</a>.</p>
<div class="fragment"><pre class="fragment">{
  debugEV &lt;&lt; <span class="stringliteral">&quot;handle broadcast\n&quot;</span>;
    <span class="keywordflow">if</span>((<a class="code" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == BUSY) &amp;&amp; (!<a class="code" href="a00128.html#a9f9f566e85a76f63e63b5907bf9ad48a">switching</a>)) {
        error(<span class="stringliteral">&quot;logic error: node is currently transmitting, can not receive &quot;</span>
              <span class="stringliteral">&quot;(does the physical layer do its job correctly?)&quot;</span>);
    }
    <a class="code" href="a00025.html#adbf061566606041db811b519f0400ed5" title="Sends a message to the upper layer.">sendUp</a>(<a class="code" href="a00128.html#a9c6a33b29ff6e1500947fd6ca221b13e" title="decapsulate packet">decapsMsg</a>(af));
    <span class="keyword">delete</span> af;
    <span class="keywordflow">if</span> (<a class="code" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == CONTEND) {
      assert(!<a class="code" href="a00128.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>-&gt;isScheduled());
    <span class="comment">//suspendContention();</span>

        <a class="code" href="a00128.html#ab3030c86acac78401f877a61cefcdad6" title="start a new contention period">beginNewCycle</a>();
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ae1e17af7dddc261d7947d48a1f4d0e21"></a><!-- doxytag: member="Mac80211::handleCTSframe" ref="ae1e17af7dddc261d7947d48a1f4d0e21" args="(Mac80211Pkt *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleCTSframe </td>
          <td>(</td>
          <td class="paramtype">Mac80211Pkt *&#160;</td>
          <td class="paramname"><em>af</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Handle a CTS frame. Called by HandleMsgForMe(Mac80211Pkt* af) </p>

<p>References <a class="el" href="a00128.html#ace80836b6fcb1681f6b2d49466f87fb0">endSifs</a>, <a class="el" href="a00025.html#a6d01a0f56978740d7617c2e338858cc3">BaseLayer::sendControlDown()</a>, <a class="el" href="a00128.html#a9bbc3d71eddb62c4e12dcd500a58b0bb">shortRetryCounter</a>, and <a class="el" href="a00128.html#a2d31f97b0662b8e37f090c3b996cec82">timeout</a>.</p>

<p>Referenced by <a class="el" href="a00128.html#aa0b767642d86d3b66f1d3258065fe5ae">handleMsgForMe()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// cancel time-out event</span>
    cancelEvent(<a class="code" href="a00128.html#a2d31f97b0662b8e37f090c3b996cec82" title="Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet.">timeout</a>);
    <a class="code" href="a00128.html#a9bbc3d71eddb62c4e12dcd500a58b0bb" title="Number of frame transmission attempt.">shortRetryCounter</a> = 0;
    <span class="comment">// wait a short interframe space</span>
    <span class="keywordflow">if</span>(<a class="code" href="a00128.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>-&gt;isScheduled()) error(<span class="stringliteral">&quot;Mac80211::handleCTSframe when SIFS scheduled&quot;</span>);
    <a class="code" href="a00128.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>-&gt;setContextPointer(af);

    <a class="code" href="a00025.html#a6d01a0f56978740d7617c2e338858cc3" title="Sends a control message to a lower layer.">sendControlDown</a>(<a class="code" href="a00128.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>);
    <span class="comment">//scheduleAt(simTime() + SIFS, endSifs);</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab0844f9dbcece750c9a58ca9f0a73fe1"></a><!-- doxytag: member="Mac80211::handleDATAframe" ref="ab0844f9dbcece750c9a58ca9f0a73fe1" args="(Mac80211Pkt *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleDATAframe </td>
          <td>(</td>
          <td class="paramtype">Mac80211Pkt *&#160;</td>
          <td class="paramname"><em>af</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Handle a frame which expected to be a DATA frame. Called by HandleMsgForMe() </p>

<p>References <a class="el" href="a00128.html#a9c6a33b29ff6e1500947fd6ca221b13e">decapsMsg()</a>, <a class="el" href="a00128.html#ace80836b6fcb1681f6b2d49466f87fb0">endSifs</a>, <a class="el" href="a00128.html#aaf9d15b3d9055b2f56d4eddce7cc9850">findNeighbor()</a>, <a class="el" href="a00128.html#a4caf1f3c2c004851555c9c691b82edf9">neighbors</a>, <a class="el" href="a00128.html#aa316943080d714ffc3c0bf54ea8aeb08">rtsCts()</a>, <a class="el" href="a00025.html#a6d01a0f56978740d7617c2e338858cc3">BaseLayer::sendControlDown()</a>, <a class="el" href="a00025.html#adbf061566606041db811b519f0400ed5">BaseLayer::sendUp()</a>, and <a class="el" href="a00128.html#a2d31f97b0662b8e37f090c3b996cec82">timeout</a>.</p>

<p>Referenced by <a class="el" href="a00128.html#aa0b767642d86d3b66f1d3258065fe5ae">handleMsgForMe()</a>.</p>
<div class="fragment"><pre class="fragment">{
    NeighborList::iterator it;
    <span class="keywordflow">if</span> (<a class="code" href="a00128.html#aa316943080d714ffc3c0bf54ea8aeb08" title="Check whether the next packet should be send with RTS/CTS.">rtsCts</a>(af)) cancelEvent(<a class="code" href="a00128.html#a2d31f97b0662b8e37f090c3b996cec82" title="Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet.">timeout</a>);  <span class="comment">// cancel time-out event</span>
    it = <a class="code" href="a00128.html#aaf9d15b3d9055b2f56d4eddce7cc9850" title="find a neighbor based on his address">findNeighbor</a>(af-&gt;getSrcAddr());
    <span class="keywordflow">if</span>(it == <a class="code" href="a00128.html#a4caf1f3c2c004851555c9c691b82edf9" title="A list of this hosts neighbors.">neighbors</a>.end()) error(<span class="stringliteral">&quot;Mac80211::handleDATAframe: neighbor not registered&quot;</span>);
    <span class="keywordflow">if</span>(af-&gt;getRetry() &amp;&amp; (it-&gt;fsc == af-&gt;getSequenceControl())) {
      debugEV &lt;&lt; <span class="stringliteral">&quot;Mac80211::handleDATAframe suppressed duplicate message &quot;</span> &lt;&lt; af
           &lt;&lt; <span class="stringliteral">&quot; fsc: &quot;</span> &lt;&lt; it-&gt;fsc &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
    }
    <span class="keywordflow">else</span> {
        it-&gt;fsc = af-&gt;getSequenceControl();
        <span class="comment">// pass the packet to the upper layer</span>
        <a class="code" href="a00025.html#adbf061566606041db811b519f0400ed5" title="Sends a message to the upper layer.">sendUp</a>(<a class="code" href="a00128.html#a9c6a33b29ff6e1500947fd6ca221b13e" title="decapsulate packet">decapsMsg</a>(af));
    }
    <span class="comment">// wait a short interframe space</span>
    <span class="keywordflow">if</span>(<a class="code" href="a00128.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>-&gt;isScheduled()) error(<span class="stringliteral">&quot;Mac80211::handleDATAframe when SIFS scheduled&quot;</span>);
    <a class="code" href="a00128.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>-&gt;setContextPointer(af);

    <a class="code" href="a00025.html#a6d01a0f56978740d7617c2e338858cc3" title="Sends a control message to a lower layer.">sendControlDown</a>(<a class="code" href="a00128.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>);
    <span class="comment">//scheduleAt(simTime() + SIFS, endSifs);</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0a87fa1791117ef1dd1841ba217e4245"></a><!-- doxytag: member="Mac80211::handleEndContentionTimer" ref="a0a87fa1791117ef1dd1841ba217e4245" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleEndContentionTimer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>handle end of contention </p>
<p>The node has won the contention, and is now allowed to send an RTS/DATA or Broadcast packet. The backoff value is deleted and will be newly computed in the next contention period </p>

<p>References <a class="el" href="a00128.html#a7bd4f3adc205b150f9fa406fa582f0b6">contention</a>, <a class="el" href="a00128.html#a4a9d1c8d45c46f18afa0f07f5b6572f4">currentIFS</a>, <a class="el" href="a00128.html#a969e8e3a592dffccea28596c61b2af50">fromUpperLayer</a>, <a class="el" href="a00128.html#a5d8e9b53c8d6cb0116feed506d843e18">nextIsBroadcast</a>, <a class="el" href="a00026.html#aa7b1e6bdb734765a9f4eff7d486dfbea">BaseMacLayer::phy</a>, <a class="el" href="a00128.html#a58484d1a6f2031548d433d18438042e9">remainingBackoff</a>, <a class="el" href="a00128.html#aa316943080d714ffc3c0bf54ea8aeb08">rtsCts()</a>, <a class="el" href="a00128.html#a26b30d048980b56d79c04e859bfce009">sendBROADCASTframe()</a>, <a class="el" href="a00128.html#a7a4ff22b4b999827a898794923115880">sendDATAframe()</a>, <a class="el" href="a00128.html#a3104750758ab171b20ffcfeae0079a78">sendRTSframe()</a>, <a class="el" href="a00134.html#ad25abbad9aa16bdbf24bf1dd582b1c6f">MacToPhyInterface::setRadioState()</a>, <a class="el" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c">state</a>, <a class="el" href="a00128.html#a9ae0815a0e01c4d4fd13a87393f837a8">suspendContention()</a>, and <a class="el" href="a00141.html#a5d69aacb1cf6a57827f07224219fccb7a4f6c3dfae0f5fccb76b1d42f6ccc785d">MiximRadio::TX</a>.</p>

<p>Referenced by <a class="el" href="a00128.html#a41f1a7b86f420e1f840c14badf2b0890">handleLowerControl()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span>(!<a class="code" href="a00128.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>-&gt;getResult().isIdle()) {
        <a class="code" href="a00128.html#a9ae0815a0e01c4d4fd13a87393f837a8" title="suspend an ongoing contention, pick it up again when the channel becomes idle">suspendContention</a>();
        <span class="keywordflow">return</span>;
    }

    <span class="keywordflow">if</span>(<a class="code" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == IDLE) {
        <a class="code" href="a00128.html#a58484d1a6f2031548d433d18438042e9" title="remaining backoff time. If the backoff timer is interrupted, this variable holds the remaining backof...">remainingBackoff</a> = 0;
        <span class="comment">// bug: ID: 3460932</span>
        <span class="comment">/*</span>
<span class="comment">        In Mac80211, currentIFS is set to DIFS upon successful reception and EIFS</span>
<span class="comment">        upon reception of a corrupted frame. This is correct. However, currentIFS</span>
<span class="comment">        remains unchanged while performing post-backoff. As a result, the EIFS related</span>
<span class="comment">        to reception of a corrupted frame (and subsequent post-backoff) is used again in</span>
<span class="comment">        the minimum duration of idle time before a transmission is performed (i.e. the</span>
<span class="comment">        mandatory IFS during which a station decides whether to transmit directly or go</span>
<span class="comment">        do backoff). This results in incorrect behaviour, as this is a new opportunity.</span>
<span class="comment"></span>
<span class="comment">        A fix is simple: in handleEndContentionTimer(), add &quot;currentIFS = DIFS;&quot; inside the</span>
<span class="comment">        state==IDLE if-clause. This is where post-backoff completes and not only remainingBackoff</span>
<span class="comment">        but also currentIFS should be reset.</span>
<span class="comment"></span>
<span class="comment">        See also:</span>
<span class="comment">        http://www.freeminded.org/?p=811</span>
<span class="comment">        */</span>
        <a class="code" href="a00128.html#a4a9d1c8d45c46f18afa0f07f5b6572f4" title="current IFS value (DIFS or EIFS) If an error has been detected, the next backoff requires EIFS...">currentIFS</a>       = DIFS;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == CONTEND) {
        <span class="comment">// the node has won the channel, the backoff window is deleted and</span>
        <span class="comment">// will be new calculated in the next contention period</span>
        <a class="code" href="a00128.html#a58484d1a6f2031548d433d18438042e9" title="remaining backoff time. If the backoff timer is interrupted, this variable holds the remaining backof...">remainingBackoff</a> = 0;
        <span class="comment">// unicast packet</span>
        <a class="code" href="a00026.html#aa7b1e6bdb734765a9f4eff7d486dfbea" title="Handler to the physical layer.">phy</a>-&gt;<a class="code" href="a00134.html#ad25abbad9aa16bdbf24bf1dd582b1c6f" title="Tells the BasePhyLayer to switch to the specified radio state.">setRadioState</a>(<a class="code" href="a00141.html#a5d69aacb1cf6a57827f07224219fccb7a4f6c3dfae0f5fccb76b1d42f6ccc785d" title="transmitting state">MiximRadio::TX</a>);
        <span class="keywordflow">if</span> (!<a class="code" href="a00128.html#a5d8e9b53c8d6cb0116feed506d843e18" title="Boolean used to know if the next packet is a broadcast packet.">nextIsBroadcast</a>)
        {
            <span class="keywordflow">if</span>(<a class="code" href="a00128.html#aa316943080d714ffc3c0bf54ea8aeb08" title="Check whether the next packet should be send with RTS/CTS.">rtsCts</a>(<a class="code" href="a00128.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.front())) {
                <span class="comment">// send a RTS</span>
                <a class="code" href="a00128.html#a3104750758ab171b20ffcfeae0079a78" title="send RTS frame">sendRTSframe</a>();
            }
            <span class="keywordflow">else</span> {
                <a class="code" href="a00128.html#a7a4ff22b4b999827a898794923115880" title="send data frame">sendDATAframe</a>(0);
            }
        }<span class="comment">// broadcast packet</span>
        <span class="keywordflow">else</span> {
            <a class="code" href="a00128.html#a26b30d048980b56d79c04e859bfce009" title="send broadcast frame">sendBROADCASTframe</a>();
            <span class="comment">// removes the packet from the queue without waiting for an acknowledgement</span>
            Mac80211Pkt *temp = <a class="code" href="a00128.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.front();
            <a class="code" href="a00128.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.pop_front();
            <span class="keyword">delete</span>(temp);
        }
    }
    <span class="keywordflow">else</span> {
        error(<span class="stringliteral">&quot;logic error: expiration of the contention timer outside of CONTEND/IDLE state, should not happen&quot;</span>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7d36a55827a7ea91b2539c86d79349af"></a><!-- doxytag: member="Mac80211::handleEndSifsTimer" ref="a7d36a55827a7ea91b2539c86d79349af" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleEndSifsTimer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>handle end of SIFS </p>
<p>Handle the end sifs timer. Then sends a CTS, a DATA, or an ACK frame </p>

<p>References <a class="el" href="a00128.html#ace80836b6fcb1681f6b2d49466f87fb0">endSifs</a>, <a class="el" href="a00128.html#a969e8e3a592dffccea28596c61b2af50">fromUpperLayer</a>, <a class="el" href="a00026.html#aa7b1e6bdb734765a9f4eff7d486dfbea">BaseMacLayer::phy</a>, <a class="el" href="a00128.html#a1c404a5176db493c2fefb71537783607">sendACKframe()</a>, <a class="el" href="a00128.html#a1fd59a589e53facb68c13be84521a49e">sendCTSframe()</a>, <a class="el" href="a00128.html#a7a4ff22b4b999827a898794923115880">sendDATAframe()</a>, <a class="el" href="a00134.html#ad25abbad9aa16bdbf24bf1dd582b1c6f">MacToPhyInterface::setRadioState()</a>, <a class="el" href="a00128.html#a9fc6eb078e53740d354f8ea7b9d94713">setState()</a>, and <a class="el" href="a00141.html#a5d69aacb1cf6a57827f07224219fccb7a4f6c3dfae0f5fccb76b1d42f6ccc785d">MiximRadio::TX</a>.</p>

<p>Referenced by <a class="el" href="a00128.html#a41f1a7b86f420e1f840c14badf2b0890">handleLowerControl()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span>(!<a class="code" href="a00128.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>-&gt;getResult().isIdle()){
        <span class="comment">// delete the previously received frame</span>
        <span class="keyword">delete</span> <span class="keyword">static_cast&lt;</span>Mac80211Pkt *<span class="keyword">&gt;</span>(<a class="code" href="a00128.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>-&gt;getContextPointer());

        <span class="comment">// state in now IDLE or CONTEND</span>
        <span class="keywordflow">if</span> (<a class="code" href="a00128.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.empty())
            <a class="code" href="a00128.html#a9fc6eb078e53740d354f8ea7b9d94713" title="Sets the state, and produces a log message in between.">setState</a>(IDLE);
        <span class="keywordflow">else</span>
            <a class="code" href="a00128.html#a9fc6eb078e53740d354f8ea7b9d94713" title="Sets the state, and produces a log message in between.">setState</a>(CONTEND);

        <span class="keywordflow">return</span>;
    }

    Mac80211Pkt *frame = <span class="keyword">static_cast&lt;</span>Mac80211Pkt *<span class="keyword">&gt;</span>(<a class="code" href="a00128.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>-&gt;getContextPointer());
    <a class="code" href="a00026.html#aa7b1e6bdb734765a9f4eff7d486dfbea" title="Handler to the physical layer.">phy</a>-&gt;<a class="code" href="a00134.html#ad25abbad9aa16bdbf24bf1dd582b1c6f" title="Tells the BasePhyLayer to switch to the specified radio state.">setRadioState</a>(<a class="code" href="a00141.html#a5d69aacb1cf6a57827f07224219fccb7a4f6c3dfae0f5fccb76b1d42f6ccc785d" title="transmitting state">MiximRadio::TX</a>);
    <span class="keywordflow">switch</span> (frame-&gt;getKind())
    {
    <span class="keywordflow">case</span> RTS:
        <a class="code" href="a00128.html#a1fd59a589e53facb68c13be84521a49e" title="send CTS frame">sendCTSframe</a>(frame);
        <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> CTS:
        <a class="code" href="a00128.html#a7a4ff22b4b999827a898794923115880" title="send data frame">sendDATAframe</a>(frame);
        <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> DATA:
        <a class="code" href="a00128.html#a1c404a5176db493c2fefb71537783607" title="send Acknoledgement">sendACKframe</a>(frame);
        <span class="keywordflow">break</span>;
    <span class="keywordflow">default</span>:
        error(<span class="stringliteral">&quot;logic error: end sifs timer when previously received packet is not RTS/CTS/DATA&quot;</span>);
        <span class="keywordflow">break</span>;
    }

    <span class="comment">// don&#39;t need previous frame any more</span>
    <span class="keyword">delete</span> frame;
}
</pre></div>
</div>
</div>
<a class="anchor" id="afe4300147d9ea5e4d3e3d8c98ff20436"></a><!-- doxytag: member="Mac80211::handleEndTransmission" ref="afe4300147d9ea5e4d3e3d8c98ff20436" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleEndTransmission </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>handle the end of a transmission... </p>
<p>Handle the end of transmission timer (end of the transmission of an ACK or a broadcast packet). Called by HandleTimer(cMessage* msg) </p>

<p>References <a class="el" href="a00128.html#ade2c913df312fd4fc46106c1134889b8">backoff()</a>, <a class="el" href="a00128.html#ab3030c86acac78401f877a61cefcdad6">beginNewCycle()</a>, <a class="el" href="a00128.html#a11fb608b3564e2d2cd41b463b1a8cc90">longRetryCounter</a>, <a class="el" href="a00128.html#a5d8e9b53c8d6cb0116feed506d843e18">nextIsBroadcast</a>, <a class="el" href="a00128.html#a58484d1a6f2031548d433d18438042e9">remainingBackoff</a>, <a class="el" href="a00128.html#a9bbc3d71eddb62c4e12dcd500a58b0bb">shortRetryCounter</a>, and <a class="el" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c">state</a>.</p>

<p>Referenced by <a class="el" href="a00128.html#a41f1a7b86f420e1f840c14badf2b0890">handleLowerControl()</a>.</p>
<div class="fragment"><pre class="fragment">{
    debugEV &lt;&lt; <span class="stringliteral">&quot;transmission of packet is over\n&quot;</span>;
    <span class="keywordflow">if</span>(<a class="code" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == BUSY) {
        <span class="keywordflow">if</span>(<a class="code" href="a00128.html#a5d8e9b53c8d6cb0116feed506d843e18" title="Boolean used to know if the next packet is a broadcast packet.">nextIsBroadcast</a>) {
            <a class="code" href="a00128.html#a9bbc3d71eddb62c4e12dcd500a58b0bb" title="Number of frame transmission attempt.">shortRetryCounter</a> = 0;
            <a class="code" href="a00128.html#a11fb608b3564e2d2cd41b463b1a8cc90" title="Number of frame transmission attempt.">longRetryCounter</a> = 0;
            <a class="code" href="a00128.html#a58484d1a6f2031548d433d18438042e9" title="remaining backoff time. If the backoff timer is interrupted, this variable holds the remaining backof...">remainingBackoff</a> = <a class="code" href="a00128.html#ade2c913df312fd4fc46106c1134889b8" title="Compute a backoff value.">backoff</a>();
        }
        <a class="code" href="a00128.html#ab3030c86acac78401f877a61cefcdad6" title="start a new contention period">beginNewCycle</a>();
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == WFDATA) {
      <a class="code" href="a00128.html#ab3030c86acac78401f877a61cefcdad6" title="start a new contention period">beginNewCycle</a>();
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ac8bfb04590aab2434bd8d17ee4e213d9"></a><!-- doxytag: member="Mac80211::handleLowerMsg" ref="ac8bfb04590aab2434bd8d17ee4e213d9" args="(cMessage *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleLowerMsg </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handle messages from lower layer. </p>
<p>Handle all messages from lower layer. Checks the destination MAC adress of the packet. Then calls one of the three functions : <a class="el" href="a00128.html#a0377ddefba33b8d50c7bf4045354d7bb" title="handle a message that is not for me or errornous">handleMsgNotForMe()</a>, <a class="el" href="a00128.html#adfcf8b7a5e1db233a1bd717cecaf49bd">handleBroadcastMsg()</a>, or <a class="el" href="a00128.html#aa0b767642d86d3b66f1d3258065fe5ae" title="handle a message that was meant for me">handleMsgForMe()</a>. Called by <a class="el" href="a00025.html#a8039dac8d02052c97c1fcc209910fdde" title="Called every time a message arrives.">handleMessage()</a>. </p>

<p>Reimplemented from <a class="el" href="a00026.html#a413375cec02b990a521b62086a02264c">BaseMacLayer</a>.</p>

<p>References <a class="el" href="a00128.html#a8dd543a1a0b89f98af6d39d28dbd9e74">addNeighbor()</a>, <a class="el" href="a00128.html#a7bd4f3adc205b150f9fa406fa582f0b6">contention</a>, <a class="el" href="a00128.html#a4a9d1c8d45c46f18afa0f07f5b6572f4">currentIFS</a>, <a class="el" href="a00134.html#a00dd43576b4da205117d53bd3baadc71">MacToPhyInterface::getRadioState()</a>, <a class="el" href="a00128.html#adfcf8b7a5e1db233a1bd717cecaf49bd">handleBroadcastMsg()</a>, <a class="el" href="a00128.html#aa0b767642d86d3b66f1d3258065fe5ae">handleMsgForMe()</a>, <a class="el" href="a00128.html#a0377ddefba33b8d50c7bf4045354d7bb">handleMsgNotForMe()</a>, <a class="el" href="a00117.html#a3890f1c7314c5695e32252468e6bd5a5">LAddress::isL2Broadcast()</a>, <a class="el" href="a00026.html#a8a26df9da07801d8ccb530530ef57ee2">BaseMacLayer::myMacAddr</a>, <a class="el" href="a00026.html#aa7b1e6bdb734765a9f4eff7d486dfbea">BaseMacLayer::phy</a>, and <a class="el" href="a00141.html#a5d69aacb1cf6a57827f07224219fccb7a2c1aea88fe8363141c138da817461953">MiximRadio::RX</a>.</p>
<div class="fragment"><pre class="fragment">{
    Mac80211Pkt *af = <span class="keyword">static_cast&lt;</span>Mac80211Pkt *<span class="keyword">&gt;</span>(msg);
    <span class="keywordtype">int</span> radioState = <a class="code" href="a00026.html#aa7b1e6bdb734765a9f4eff7d486dfbea" title="Handler to the physical layer.">phy</a>-&gt;<a class="code" href="a00134.html#a00dd43576b4da205117d53bd3baadc71" title="Returns the current state the radio is in. See RadioState for possible values.">getRadioState</a>();
    <span class="keywordflow">if</span>(radioState == <a class="code" href="a00141.html#a5d69aacb1cf6a57827f07224219fccb7a2c1aea88fe8363141c138da817461953" title="receiving state">MiximRadio::RX</a>) {
        <span class="comment">// end of the reception</span>
        debugEV &lt;&lt; <span class="stringliteral">&quot; handleLowerMsg frame &quot;</span> &lt;&lt; af &lt;&lt; <span class="stringliteral">&quot; received from &quot;</span> &lt;&lt; af-&gt;getSrcAddr() &lt;&lt; <span class="stringliteral">&quot; addressed to &quot;</span> &lt;&lt; af-&gt;getDestAddr() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
        <a class="code" href="a00128.html#a8dd543a1a0b89f98af6d39d28dbd9e74" title="add a new entry to the neighbor list">addNeighbor</a>(af);
        <span class="keywordflow">if</span> (<a class="code" href="a00128.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>-&gt;isScheduled()) {
            error(<span class="stringliteral">&quot;Gaack! I am changing the IFS on an ongoing contention&quot;</span>);
        }
        <a class="code" href="a00128.html#a4a9d1c8d45c46f18afa0f07f5b6572f4" title="current IFS value (DIFS or EIFS) If an error has been detected, the next backoff requires EIFS...">currentIFS</a> = DIFS;
        <span class="keywordflow">if</span>(af-&gt;getDestAddr() == <a class="code" href="a00026.html#a8a26df9da07801d8ccb530530ef57ee2" title="MAC address.">myMacAddr</a>) {
            <a class="code" href="a00128.html#aa0b767642d86d3b66f1d3258065fe5ae" title="handle a message that was meant for me">handleMsgForMe</a>(af);
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="a00117.html#a3890f1c7314c5695e32252468e6bd5a5" title="Test if a L2 address (pSrcAddr) is a broadcast address.">LAddress::isL2Broadcast</a>(af-&gt;getDestAddr())) {
            <a class="code" href="a00128.html#adfcf8b7a5e1db233a1bd717cecaf49bd">handleBroadcastMsg</a>(af);
        }
        <span class="keywordflow">else</span> {
            <a class="code" href="a00128.html#a0377ddefba33b8d50c7bf4045354d7bb" title="handle a message that is not for me or errornous">handleMsgNotForMe</a>(af, af-&gt;getDuration());
        }
    }
    <span class="keywordflow">else</span> {
      debugEV &lt;&lt; <span class="stringliteral">&quot; handleLowerMsg frame &quot;</span> &lt;&lt; af &lt;&lt; <span class="stringliteral">&quot; deleted, strange race condition\n&quot;</span>;
        <span class="keyword">delete</span> af;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="aa0b767642d86d3b66f1d3258065fe5ae"></a><!-- doxytag: member="Mac80211::handleMsgForMe" ref="aa0b767642d86d3b66f1d3258065fe5ae" args="(Mac80211Pkt *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleMsgForMe </td>
          <td>(</td>
          <td class="paramtype">Mac80211Pkt *&#160;</td>
          <td class="paramname"><em>af</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>handle a message that was meant for me </p>
<p>Handle a packet for the node. The result of this reception is a function of the type of the received message (RTS,CTS,DATA, or ACK), and of the current state of the MAC (WFDATA, CONTEND, IDLE, WFCTS, or WFACK). Called by <a class="el" href="a00128.html#ac8bfb04590aab2434bd8d17ee4e213d9" title="Handle messages from lower layer.">handleLowerMsg()</a> </p>

<p>References <a class="el" href="a00128.html#a7bd4f3adc205b150f9fa406fa582f0b6">contention</a>, <a class="el" href="a00128.html#a50cb85360462eb7d256ec8a0b493ca44">handleACKframe()</a>, <a class="el" href="a00128.html#ae1e17af7dddc261d7947d48a1f4d0e21">handleCTSframe()</a>, <a class="el" href="a00128.html#ab0844f9dbcece750c9a58ca9f0a73fe1">handleDATAframe()</a>, <a class="el" href="a00128.html#a98ad0d3935d620b33302e5230b395685">handleRTSframe()</a>, <a class="el" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c">state</a>, <a class="el" href="a00128.html#ade8a90e665191333e610b60bad4a32a1">stateName()</a>, and <a class="el" href="a00128.html#a9f9f566e85a76f63e63b5907bf9ad48a">switching</a>.</p>

<p>Referenced by <a class="el" href="a00128.html#ac8bfb04590aab2434bd8d17ee4e213d9">handleLowerMsg()</a>.</p>
<div class="fragment"><pre class="fragment">{
  debugEV &lt;&lt; <span class="stringliteral">&quot;handle msg for me &quot;</span> &lt;&lt; af-&gt;getName() &lt;&lt; <span class="stringliteral">&quot; in &quot;</span> &lt;&lt;  <a class="code" href="a00128.html#ade8a90e665191333e610b60bad4a32a1" title="Produce a readable name of the given state.">stateName</a>(<a class="code" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;

    <span class="keywordflow">switch</span> (<a class="code" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a>)
    {
    <span class="keywordflow">case</span> IDLE:     <span class="comment">// waiting for the end of the contention period</span>
    <span class="keywordflow">case</span> CONTEND:  <span class="comment">// or waiting for RTS</span>

        <span class="comment">// RTS or DATA accepted</span>
        <span class="keywordflow">if</span> (af-&gt;getKind() == RTS) {
          assert(!<a class="code" href="a00128.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>-&gt;isScheduled());
      <span class="comment">//suspendContention();</span>

            <a class="code" href="a00128.html#a98ad0d3935d620b33302e5230b395685">handleRTSframe</a>(af);
        }
        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (af-&gt;getKind() == DATA) {
          assert(!<a class="code" href="a00128.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>-&gt;isScheduled());
          <span class="comment">//suspendContention();</span>

            <a class="code" href="a00128.html#ab0844f9dbcece750c9a58ca9f0a73fe1">handleDATAframe</a>(af);
        }
        <span class="keywordflow">else</span> {
            error(<span class="stringliteral">&quot;in handleMsgForMe() IDLE/CONTEND, strange message %s&quot;</span>, af-&gt;getName());
        }
        <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> WFDATA:  <span class="comment">// waiting for DATA</span>
        <span class="keywordflow">if</span> (af-&gt;getKind() == DATA) {
            <a class="code" href="a00128.html#ab0844f9dbcece750c9a58ca9f0a73fe1">handleDATAframe</a>(af);
        }
        <span class="keywordflow">else</span> {
          EV &lt;&lt; <span class="stringliteral">&quot;unexpected message -- probably a collision of RTSs\n&quot;</span>;
            <span class="keyword">delete</span> af;
        }
        <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> WFACK:  <span class="comment">// waiting for ACK</span>
        <span class="keywordflow">if</span> (af-&gt;getKind() == ACK) {
            <a class="code" href="a00128.html#a50cb85360462eb7d256ec8a0b493ca44">handleACKframe</a>(af);
        }
        <span class="keywordflow">else</span> {
            error(<span class="stringliteral">&quot;in handleMsgForMe() WFACK, strange message %s&quot;</span>, af-&gt;getName());
        }
        <span class="keyword">delete</span> af;
        <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> WFCTS:  <span class="comment">// The MAC is waiting for CTS</span>
        <span class="keywordflow">if</span> (af-&gt;getKind() == CTS) {
            <a class="code" href="a00128.html#ae1e17af7dddc261d7947d48a1f4d0e21">handleCTSframe</a>(af);
        }
        <span class="keywordflow">else</span> {
            EV &lt;&lt; <span class="stringliteral">&quot;unexpected msg -- deleted \n&quot;</span>;
            <span class="keyword">delete</span> af;
        }
        <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> QUIET: <span class="comment">// the node is currently deferring.</span>

        <span class="comment">// cannot handle any packet with its MAC adress</span>
        <span class="keyword">delete</span> af;
        <span class="keywordflow">break</span>;

    <span class="keywordflow">case</span> BUSY: <span class="comment">// currently transmitting an ACK or a BROADCAST packet</span>
        <span class="keywordflow">if</span>(<a class="code" href="a00128.html#a9f9f566e85a76f63e63b5907bf9ad48a">switching</a>) {
            EV &lt;&lt; <span class="stringliteral">&quot;message received during radio state switchover\n&quot;</span>;
            <span class="keyword">delete</span> af;
        }
        <span class="keywordflow">else</span> {
            error(<span class="stringliteral">&quot;logic error: node is currently transmitting, can not receive &quot;</span>
                  <span class="stringliteral">&quot;(does the physical layer do its job correctly?)&quot;</span>);
        }
        <span class="keywordflow">break</span>;
    <span class="keywordflow">default</span>:
        error(<span class="stringliteral">&quot;unknown state %d&quot;</span>, <a class="code" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a>);
        <span class="keywordflow">break</span>;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a0377ddefba33b8d50c7bf4045354d7bb"></a><!-- doxytag: member="Mac80211::handleMsgNotForMe" ref="a0377ddefba33b8d50c7bf4045354d7bb" args="(cMessage *af, simtime_t_cref duration)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleMsgNotForMe </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>af</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">simtime_t_cref&#160;</td>
          <td class="paramname"><em>duration</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>handle a message that is not for me or errornous </p>
<p>Handle all ACKs,RTS, CTS, or DATA not for the node. If RTS/CTS is used the node must stay quiet until the current handshake between the two communicating nodes is over. This is done by scheduling the timer message nav (Network Allocation Vector). Without RTS/CTS a new contention is started. If an error occured the node must defer for EIFS. Called by <a class="el" href="a00128.html#ac8bfb04590aab2434bd8d17ee4e213d9" title="Handle messages from lower layer.">handleLowerMsg()</a> </p>

<p>References <a class="el" href="a00128.html#ab3030c86acac78401f877a61cefcdad6">beginNewCycle()</a>, <a class="el" href="a00071.html#aadf94ce46e3edca3fa4d93150f72f4aeae5c2edad30720b7e527373b28bd4e1ab">Decider80211::COLLISION</a>, <a class="el" href="a00128.html#a7bd4f3adc205b150f9fa406fa582f0b6">contention</a>, <a class="el" href="a00128.html#a4a9d1c8d45c46f18afa0f07f5b6572f4">currentIFS</a>, <a class="el" href="a00128.html#a969e8e3a592dffccea28596c61b2af50">fromUpperLayer</a>, <a class="el" href="a00128.html#a11fb608b3564e2d2cd41b463b1a8cc90">longRetryCounter</a>, <a class="el" href="a00128.html#a35efb0198d0085a341aba515bec9146f">nav</a>, <a class="el" href="a00026.html#a49e0e548a6c20d002bd67afa7b76c483adebf9c77bbe6f19772866cccbef0fe4b">BaseMacLayer::PACKET_DROPPED</a>, <a class="el" href="a00128.html#aa316943080d714ffc3c0bf54ea8aeb08">rtsCts()</a>, <a class="el" href="a00128.html#a9fc6eb078e53740d354f8ea7b9d94713">setState()</a>, <a class="el" href="a00128.html#a9bbc3d71eddb62c4e12dcd500a58b0bb">shortRetryCounter</a>, <a class="el" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c">state</a>, and <a class="el" href="a00128.html#a2d31f97b0662b8e37f090c3b996cec82">timeout</a>.</p>

<p>Referenced by <a class="el" href="a00128.html#a41f1a7b86f420e1f840c14badf2b0890">handleLowerControl()</a>, and <a class="el" href="a00128.html#ac8bfb04590aab2434bd8d17ee4e213d9">handleLowerMsg()</a>.</p>
<div class="fragment"><pre class="fragment">{
  debugEV &lt;&lt; <span class="stringliteral">&quot;handle msg not for me &quot;</span> &lt;&lt; af-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;

    <span class="comment">// if the duration of the packet is null, then do nothing (to avoid</span>
    <span class="comment">// the unuseful scheduling of a self message)</span>
    <span class="keywordflow">if</span>(duration != 0) {
        <span class="comment">// the node is already deferring</span>
        <span class="keywordflow">if</span> (<a class="code" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == QUIET)
        {
            <span class="comment">// the current value of the NAV is not sufficient</span>
            <span class="keywordflow">if</span> (<a class="code" href="a00128.html#a35efb0198d0085a341aba515bec9146f" title="Timer used for the defer time of a node. Also called NAV : networks allocation vector.">nav</a>-&gt;getArrivalTime() &lt; simTime() + duration)
            {
                cancelEvent(<a class="code" href="a00128.html#a35efb0198d0085a341aba515bec9146f" title="Timer used for the defer time of a node. Also called NAV : networks allocation vector.">nav</a>);
                scheduleAt(simTime() + duration, <a class="code" href="a00128.html#a35efb0198d0085a341aba515bec9146f" title="Timer used for the defer time of a node. Also called NAV : networks allocation vector.">nav</a>);
                debugEV &lt;&lt; <span class="stringliteral">&quot;NAV timer started for: &quot;</span> &lt;&lt; duration &lt;&lt; <span class="stringliteral">&quot; State QUIET\n&quot;</span>;
            }
        }
        <span class="comment">// other states</span>
        <span class="keywordflow">else</span>
        {
            <span class="comment">// if the MAC wait for another frame, it can delete its time out</span>
            <span class="comment">// (exchange is aborted)</span>
            <span class="keywordflow">if</span> (<a class="code" href="a00128.html#a2d31f97b0662b8e37f090c3b996cec82" title="Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet.">timeout</a>-&gt;isScheduled()) {
                cancelEvent(<a class="code" href="a00128.html#a2d31f97b0662b8e37f090c3b996cec82" title="Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet.">timeout</a>);
                <span class="keywordflow">if</span>(<a class="code" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == WFACK) {
                    <a class="code" href="a00128.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.front()-&gt;setRetry(<span class="keyword">true</span>);
                }
                <span class="keywordflow">if</span>((<a class="code" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == WFACK) || (<a class="code" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == WFCTS)) {
                    <span class="keywordflow">if</span>(<a class="code" href="a00128.html#aa316943080d714ffc3c0bf54ea8aeb08" title="Check whether the next packet should be send with RTS/CTS.">rtsCts</a>(<a class="code" href="a00128.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.front())) {
                        <a class="code" href="a00128.html#a11fb608b3564e2d2cd41b463b1a8cc90" title="Number of frame transmission attempt.">longRetryCounter</a>++;
                    }
                    <span class="keywordflow">else</span> {
                        <a class="code" href="a00128.html#a9bbc3d71eddb62c4e12dcd500a58b0bb" title="Number of frame transmission attempt.">shortRetryCounter</a>++;
                    }
                }
            }
            <span class="comment">// the node must defer for the time of the transmission</span>
            scheduleAt(simTime() + duration, <a class="code" href="a00128.html#a35efb0198d0085a341aba515bec9146f" title="Timer used for the defer time of a node. Also called NAV : networks allocation vector.">nav</a>);
            debugEV &lt;&lt; <span class="stringliteral">&quot;NAV timer started, not QUIET: &quot;</span> &lt;&lt; duration &lt;&lt; endl;

            assert(!<a class="code" href="a00128.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>-&gt;isScheduled());
            <span class="comment">//suspendContention();</span>

            <a class="code" href="a00128.html#a9fc6eb078e53740d354f8ea7b9d94713" title="Sets the state, and produces a log message in between.">setState</a>(QUIET);
        }
    }

    <span class="keywordflow">if</span>((af-&gt;getKind() == <a class="code" href="a00026.html#a49e0e548a6c20d002bd67afa7b76c483adebf9c77bbe6f19772866cccbef0fe4b">BaseDecider::PACKET_DROPPED</a>) || (af-&gt;getKind() == <a class="code" href="a00071.html#aadf94ce46e3edca3fa4d93150f72f4aeae5c2edad30720b7e527373b28bd4e1ab" title="Packet lost due to collision.">Decider80211::COLLISION</a>)) {

      assert(!<a class="code" href="a00128.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>-&gt;isScheduled());
        <span class="comment">//suspendContention();</span>
        <span class="comment">//if (contention-&gt;isScheduled()) {</span>
        <span class="comment">//    error(&quot;Gaack! I am changing the IFS on an ongoing contention&quot;);</span>
        <span class="comment">//}</span>

      <span class="comment">//handle broken cts and ACK frames</span>
      <span class="keywordflow">if</span>(<a class="code" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == WFCTS) {
        assert(<a class="code" href="a00128.html#a2d31f97b0662b8e37f090c3b996cec82" title="Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet.">timeout</a>-&gt;isScheduled());
        cancelEvent(<a class="code" href="a00128.html#a2d31f97b0662b8e37f090c3b996cec82" title="Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet.">timeout</a>);
        rtsTransmissionFailed();
      }
      <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == WFACK) {
        assert(<a class="code" href="a00128.html#a2d31f97b0662b8e37f090c3b996cec82" title="Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet.">timeout</a>-&gt;isScheduled());
      cancelEvent(<a class="code" href="a00128.html#a2d31f97b0662b8e37f090c3b996cec82" title="Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet.">timeout</a>);
        dataTransmissionFailed();
      }

        <a class="code" href="a00128.html#a4a9d1c8d45c46f18afa0f07f5b6572f4" title="current IFS value (DIFS or EIFS) If an error has been detected, the next backoff requires EIFS...">currentIFS</a> = EIFS;
    }

    <a class="code" href="a00128.html#ab3030c86acac78401f877a61cefcdad6" title="start a new contention period">beginNewCycle</a>();
    <span class="keyword">delete</span> af;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a23a142d65d7a0dcba4a60c0f509ab5b9"></a><!-- doxytag: member="Mac80211::handleNavTimer" ref="a23a142d65d7a0dcba4a60c0f509ab5b9" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleNavTimer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>NAV timer expired, the exchange of messages of other stations is done. </p>
<p>Handle the NAV timer (end of a defering period). Called by HandleTimer(cMessage* msg) </p>

<p>References <a class="el" href="a00128.html#ab3030c86acac78401f877a61cefcdad6">beginNewCycle()</a>, and <a class="el" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c">state</a>.</p>

<p>Referenced by <a class="el" href="a00128.html#a990af33f857669759da0cbeebd1c2431">handleSelfMsg()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> (<a class="code" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> != QUIET)
        error(<span class="stringliteral">&quot;logic error: expiration of the NAV timer outside of the state QUIET, should not happen&quot;</span>);

    <span class="comment">// if there&#39;s a packet to send and if the channel is free, then start a new contention period</span>

    <span class="comment">// lmf - Potential race condition: If nav expires at same time</span>
    <span class="comment">// medium becomes IDLE (usual case), but the navTimeout comes</span>
    <span class="comment">// before the mediumIndication, then the medium is still BUSY when</span>
    <span class="comment">// beginNewCycle() is called, so the backoff doesn&#39;t resume.</span>
    <span class="comment">// Usually it doesn&#39;t matter, since there is also an arriving</span>
    <span class="comment">// frame and so beginNewCycle() will be called again by the</span>
    <span class="comment">// handleMsgXXX.  But if there is no frame (mobility, exposed</span>
    <span class="comment">// terminal, etc) there&#39;s a potential problem.</span>

    <a class="code" href="a00128.html#ab3030c86acac78401f877a61cefcdad6" title="start a new contention period">beginNewCycle</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="a98ad0d3935d620b33302e5230b395685"></a><!-- doxytag: member="Mac80211::handleRTSframe" ref="a98ad0d3935d620b33302e5230b395685" args="(Mac80211Pkt *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleRTSframe </td>
          <td>(</td>
          <td class="paramtype">Mac80211Pkt *&#160;</td>
          <td class="paramname"><em>af</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Handle aframe wich is expected to be an RTS. Called by HandleMsgForMe() </p>

<p>References <a class="el" href="a00128.html#ace80836b6fcb1681f6b2d49466f87fb0">endSifs</a>, and <a class="el" href="a00025.html#a6d01a0f56978740d7617c2e338858cc3">BaseLayer::sendControlDown()</a>.</p>

<p>Referenced by <a class="el" href="a00128.html#aa0b767642d86d3b66f1d3258065fe5ae">handleMsgForMe()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span>(<a class="code" href="a00128.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>-&gt;isScheduled()) error(<span class="stringliteral">&quot;Mac80211::handleRTSframe when SIFS scheduled&quot;</span>);
    <span class="comment">// wait a short interframe space</span>
    <a class="code" href="a00128.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>-&gt;setContextPointer(af);

    <a class="code" href="a00025.html#a6d01a0f56978740d7617c2e338858cc3" title="Sends a control message to a lower layer.">sendControlDown</a>(<a class="code" href="a00128.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>);
    <span class="comment">//scheduleAt(simTime() + SIFS, endSifs);</span>
}
</pre></div>
</div>
</div>
<a class="anchor" id="a990af33f857669759da0cbeebd1c2431"></a><!-- doxytag: member="Mac80211::handleSelfMsg" ref="a990af33f857669759da0cbeebd1c2431" args="(cMessage *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleSelfMsg </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handle self messages such as timer... </p>
<p>handle timers </p>

<p>Reimplemented from <a class="el" href="a00026.html#add5277c1a60dab10db40c8d9641e48c4">BaseMacLayer</a>.</p>

<p>References <a class="el" href="a00128.html#a23a142d65d7a0dcba4a60c0f509ab5b9">handleNavTimer()</a>, and <a class="el" href="a00128.html#ab5fcba8c7a3878ac59195a483ba35a12">handleTimeoutTimer()</a>.</p>
<div class="fragment"><pre class="fragment">{
  debugEV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; handleSelfMsg &quot;</span> &lt;&lt; msg-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
    <span class="keywordflow">switch</span> (msg-&gt;getKind())
    {
        <span class="comment">// the MAC was waiting for a CTS, a DATA, or an ACK packet but the timer has expired.</span>
    <span class="keywordflow">case</span> TIMEOUT:
        <a class="code" href="a00128.html#ab5fcba8c7a3878ac59195a483ba35a12" title="handle time out">handleTimeoutTimer</a>();   <span class="comment">// noch zu betrachten..</span>
        <span class="keywordflow">break</span>;

        <span class="comment">// the MAC was waiting because an other communication had won the channel. This communication is now over</span>
    <span class="keywordflow">case</span> NAV:
        <a class="code" href="a00128.html#a23a142d65d7a0dcba4a60c0f509ab5b9" title="NAV timer expired, the exchange of messages of other stations is done.">handleNavTimer</a>();       <span class="comment">// noch zu betrachten...</span>
        <span class="keywordflow">break</span>;

    <span class="keywordflow">default</span>:
        error(<span class="stringliteral">&quot;unknown timer type&quot;</span>);
        <span class="keywordflow">break</span>;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab5fcba8c7a3878ac59195a483ba35a12"></a><!-- doxytag: member="Mac80211::handleTimeoutTimer" ref="ab5fcba8c7a3878ac59195a483ba35a12" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleTimeoutTimer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>handle time out </p>
<p>Handle the time out timer. Called by handleTimer(cMessage* msg) </p>

<p>References <a class="el" href="a00128.html#ab3030c86acac78401f877a61cefcdad6">beginNewCycle()</a>, <a class="el" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c">state</a>, and <a class="el" href="a00128.html#ade8a90e665191333e610b60bad4a32a1">stateName()</a>.</p>

<p>Referenced by <a class="el" href="a00128.html#a990af33f857669759da0cbeebd1c2431">handleSelfMsg()</a>.</p>
<div class="fragment"><pre class="fragment">{
    debugEV &lt;&lt; simTime() &lt;&lt; <span class="stringliteral">&quot; handleTimeoutTimer &quot;</span> &lt;&lt; <a class="code" href="a00128.html#ade8a90e665191333e610b60bad4a32a1" title="Produce a readable name of the given state.">stateName</a>(<a class="code" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a>) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
    <span class="keywordflow">if</span>(<a class="code" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == WFCTS) {
      rtsTransmissionFailed();
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == WFACK) {
      dataTransmissionFailed();
    }

    <span class="comment">// if there&#39;s a packet to send and if the channel is free then</span>
    <span class="comment">// start a new contention period</span>
    <span class="keywordflow">if</span> (<a class="code" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> != QUIET)
        <a class="code" href="a00128.html#ab3030c86acac78401f877a61cefcdad6" title="start a new contention period">beginNewCycle</a>();
}
</pre></div>
</div>
</div>
<a class="anchor" id="af7e230f8713536482417699f2f6bee71"></a><!-- doxytag: member="Mac80211::handleUpperMsg" ref="af7e230f8713536482417699f2f6bee71" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::handleUpperMsg </td>
          <td>(</td>
          <td class="paramtype">cMessage *&#160;</td>
          <td class="paramname"><em>msg</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Handle messages from upper layer. </p>
<p>This implementation does not support fragmentation, so it is tested if the maximum length of the MPDU is exceeded. </p>

<p>Reimplemented from <a class="el" href="a00026.html#a6de2ca07018de313a7147a03e6d77bff">BaseMacLayer</a>.</p>

<p>References <a class="el" href="a00128.html#ab3030c86acac78401f877a61cefcdad6">beginNewCycle()</a>, <a class="el" href="a00128.html#a23738e3ef2aa14da9dbdcb3d0abbf4e2">encapsMsg()</a>, <a class="el" href="a00128.html#ace80836b6fcb1681f6b2d49466f87fb0">endSifs</a>, <a class="el" href="a00128.html#a969e8e3a592dffccea28596c61b2af50">fromUpperLayer</a>, <a class="el" href="a00026.html#a49e0e548a6c20d002bd67afa7b76c483adebf9c77bbe6f19772866cccbef0fe4b">BaseMacLayer::PACKET_DROPPED</a>, <a class="el" href="a00128.html#ae8892c105c3f0fb2b6f28634bb099f31">queueLength</a>, <a class="el" href="a00025.html#aa1190a06fb4dfb15d8ff001468335dc8">BaseLayer::sendControlUp()</a>, and <a class="el" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c">state</a>.</p>
<div class="fragment"><pre class="fragment">{
  cPacket* pkt = <span class="keyword">static_cast&lt;</span>cPacket*<span class="keyword">&gt;</span>(msg);

  debugEV &lt;&lt; <span class="stringliteral">&quot;Mac80211::handleUpperMsg &quot;</span> &lt;&lt; msg-&gt;getName() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
    <span class="keywordflow">if</span> (pkt-&gt;getBitLength() &gt; 18496){
        error(<span class="stringliteral">&quot;packet from higher layer (%s)%s is too long for 802.11b, %d bytes (fragmentation is not supported yet)&quot;</span>,
              pkt-&gt;getClassName(), pkt-&gt;getName(), pkt-&gt;getByteLength());
    }

    <span class="keywordflow">if</span>(<a class="code" href="a00128.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.size() == <a class="code" href="a00128.html#ae8892c105c3f0fb2b6f28634bb099f31" title="Maximal number of packets in the queue; should be set in the omnetpp.ini.">queueLength</a>) {
    <span class="comment">//TODO: CSMAMacLayer does create a new mac packet and sends it up. Maybe settle on a consistent solution here</span>
        msg-&gt;setName(<span class="stringliteral">&quot;MAC ERROR&quot;</span>);
        msg-&gt;setKind(<a class="code" href="a00026.html#a49e0e548a6c20d002bd67afa7b76c483adebf9c77bbe6f19772866cccbef0fe4b">PACKET_DROPPED</a>);
        <a class="code" href="a00025.html#aa1190a06fb4dfb15d8ff001468335dc8" title="Sends a control message to an upper layer.">sendControlUp</a>(msg);
        debugEV &lt;&lt; <span class="stringliteral">&quot;packet &quot;</span> &lt;&lt; msg &lt;&lt; <span class="stringliteral">&quot; received from higher layer but MAC queue is full, signalling error\n&quot;</span>;
        <span class="keywordflow">return</span>;
    }

    Mac80211Pkt *mac = <span class="keyword">static_cast&lt;</span>Mac80211Pkt*<span class="keyword">&gt;</span>(<a class="code" href="a00128.html#a23738e3ef2aa14da9dbdcb3d0abbf4e2" title="encapsulate packet">encapsMsg</a>(pkt));
    debugEV &lt;&lt; <span class="stringliteral">&quot;packet &quot;</span> &lt;&lt; pkt &lt;&lt; <span class="stringliteral">&quot; received from higher layer, dest=&quot;</span> &lt;&lt; mac-&gt;getDestAddr() &lt;&lt; <span class="stringliteral">&quot;, encapsulated\n&quot;</span>;

    <a class="code" href="a00128.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.push_back(mac);
    <span class="comment">// If the MAC is in the IDLE state, then start a new contention period</span>
    <span class="keywordflow">if</span> (<a class="code" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> == IDLE &amp;&amp; !<a class="code" href="a00128.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>-&gt;isScheduled()) {
        <a class="code" href="a00128.html#ab3030c86acac78401f877a61cefcdad6" title="start a new contention period">beginNewCycle</a>();
    }
    <span class="keywordflow">else</span>
    {
      debugEV &lt;&lt; <span class="stringliteral">&quot;enqueued, will be transmitted later\n&quot;</span>;
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="ab81dae24d79c2ef010301e2c219966c1"></a><!-- doxytag: member="Mac80211::initialize" ref="ab81dae24d79c2ef010301e2c219966c1" args="(int)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::initialize </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>stage</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialization of the module and some variables. </p>
<p>First we have to initialize the module from which we derived ours, in this case <a class="el" href="a00025.html" title="A very simple layer template.">BaseLayer</a>. </p>

<p>Reimplemented from <a class="el" href="a00026.html#a61c82dc3b225eac37f7fa9936c28c2c3">BaseMacLayer</a>.</p>

<p>Reimplemented in <a class="el" href="a00129.html#aa7351afc794f983e34dbc86d63cb3dea">Mac80211MultiChannel</a>.</p>

<p>References <a class="el" href="a00128.html#a979883a8da4b308de4a8e79b5bbbe2e6">autoBitrate</a>, <a class="el" href="a00128.html#ade2c913df312fd4fc46106c1134889b8">backoff()</a>, <a class="el" href="a00128.html#a126c9db5a54bafa6ad74eb3ee24bd936">bitrate</a>, <a class="el" href="a00128.html#a67eba657efe23f5e5c21904f4744261d">centerFreq</a>, <a class="el" href="a00134.html#a36bc50a86bf1cc0f9efd374613d61a52aa6ff58f5815b155504d37339ee5c7222">MacToPhyInterface::CHANNEL_SENSE_REQUEST</a>, <a class="el" href="a00128.html#a7bd4f3adc205b150f9fa406fa582f0b6">contention</a>, <a class="el" href="a00128.html#a4a9d1c8d45c46f18afa0f07f5b6572f4">currentIFS</a>, <a class="el" href="a00095.html#af308407856d9835b103f2421e373ee28">FWMath::dBm2mW()</a>, <a class="el" href="a00128.html#a226566e4a56cfed2928acc87ff3af90a">defaultBitrate</a>, <a class="el" href="a00128.html#ab9f0ea820748af6d640569fc76f39659">delta</a>, <a class="el" href="a00128.html#ace80836b6fcb1681f6b2d49466f87fb0">endSifs</a>, <a class="el" href="a00128.html#a026837b7167d230bbe79a1e0630c7578">fsc</a>, <a class="el" href="a00026.html#a68f36d36168a8ba5c8a4c84c17f1ba40">BaseMacLayer::getConnectionManager()</a>, <a class="el" href="a00134.html#a6271dfe09bf5cef8c8afb96de00182ab">MacToPhyInterface::getCurrentRadioChannel()</a>, <a class="el" href="a00128.html#a11fb608b3564e2d2cd41b463b1a8cc90">longRetryCounter</a>, <a class="el" href="a00026.html#a8a26df9da07801d8ccb530530ef57ee2">BaseMacLayer::myMacAddr</a>, <a class="el" href="a00128.html#a35efb0198d0085a341aba515bec9146f">nav</a>, <a class="el" href="a00128.html#aede2e9e4e32ef871e3a59c51564123de">neighborhoodCacheMaxAge</a>, <a class="el" href="a00128.html#ae62ff2c9617e5782f6f7231e36d1574d">neighborhoodCacheSize</a>, <a class="el" href="a00026.html#aa7b1e6bdb734765a9f4eff7d486dfbea">BaseMacLayer::phy</a>, <a class="el" href="a00128.html#ae8892c105c3f0fb2b6f28634bb099f31">queueLength</a>, <a class="el" href="a00128.html#a58484d1a6f2031548d433d18438042e9">remainingBackoff</a>, <a class="el" href="a00128.html#a6ad4dd93415c98c969df05f53d739cfd">rtsCtsThreshold</a>, <a class="el" href="a00128.html#a59cb9e6071f33bc460a2f3a662c4bc59">senseChannelWhileIdle()</a>, <a class="el" href="a00128.html#a9bbc3d71eddb62c4e12dcd500a58b0bb">shortRetryCounter</a>, <a class="el" href="a00128.html#a1cd38454a518f922ba57f68d22e2f31e">snrThresholds</a>, <a class="el" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c">state</a>, <a class="el" href="a00128.html#a9f9f566e85a76f63e63b5907bf9ad48a">switching</a>, <a class="el" href="a00128.html#a2d31f97b0662b8e37f090c3b996cec82">timeout</a>, and <a class="el" href="a00128.html#a592eee2a24a6fcadd6fdf912a101719f">txPower</a>.</p>
<div class="fragment"><pre class="fragment">{
    <a class="code" href="a00128.html#ab81dae24d79c2ef010301e2c219966c1" title="Initialization of the module and some variables.">BaseMacLayer::initialize</a>(stage);

    <span class="keywordflow">if</span> (stage == 0)
    {
        debugEV &lt;&lt; <span class="stringliteral">&quot;Initializing stage 0\n&quot;</span>;

        <a class="code" href="a00128.html#a9f9f566e85a76f63e63b5907bf9ad48a">switching</a> = <span class="keyword">false</span>;
        <a class="code" href="a00128.html#a026837b7167d230bbe79a1e0630c7578">fsc</a> = intrand(0x7FFFFFFF);
        <span class="keywordflow">if</span>(<a class="code" href="a00128.html#a026837b7167d230bbe79a1e0630c7578">fsc</a> == 0) <a class="code" href="a00128.html#a026837b7167d230bbe79a1e0630c7578">fsc</a> = 1;
        debugEV &lt;&lt; <span class="stringliteral">&quot; fsc: &quot;</span> &lt;&lt; <a class="code" href="a00128.html#a026837b7167d230bbe79a1e0630c7578">fsc</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;

        <a class="code" href="a00128.html#ae8892c105c3f0fb2b6f28634bb099f31" title="Maximal number of packets in the queue; should be set in the omnetpp.ini.">queueLength</a> = hasPar(<span class="stringliteral">&quot;queueLength&quot;</span>) ? par(<span class="stringliteral">&quot;queueLength&quot;</span>).longValue() : 10;

        <span class="comment">// timers</span>
        <a class="code" href="a00128.html#a2d31f97b0662b8e37f090c3b996cec82" title="Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet.">timeout</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;timeout&quot;</span>, TIMEOUT);
        <a class="code" href="a00128.html#a35efb0198d0085a341aba515bec9146f" title="Timer used for the defer time of a node. Also called NAV : networks allocation vector.">nav</a> = <span class="keyword">new</span> cMessage(<span class="stringliteral">&quot;NAV&quot;</span>, NAV);
        <a class="code" href="a00128.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a> = <span class="keyword">new</span> ChannelSenseRequest(<span class="stringliteral">&quot;contention&quot;</span>, <a class="code" href="a00134.html#a36bc50a86bf1cc0f9efd374613d61a52aa6ff58f5815b155504d37339ee5c7222" title="Channel sense control message between Mac and Phy.">MacToPhyInterface::CHANNEL_SENSE_REQUEST</a>);
        <a class="code" href="a00128.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>-&gt;setSenseMode(UNTIL_BUSY);
        <a class="code" href="a00128.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a> = <span class="keyword">new</span> ChannelSenseRequest(<span class="stringliteral">&quot;end SIFS&quot;</span>, <a class="code" href="a00134.html#a36bc50a86bf1cc0f9efd374613d61a52aa6ff58f5815b155504d37339ee5c7222" title="Channel sense control message between Mac and Phy.">MacToPhyInterface::CHANNEL_SENSE_REQUEST</a>);
        <a class="code" href="a00128.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>-&gt;setSenseMode(UNTIL_BUSY);
        <a class="code" href="a00128.html#ace80836b6fcb1681f6b2d49466f87fb0" title="Timer used to indicate the end of a SIFS.">endSifs</a>-&gt;setSenseTimeout(SIFS);

        <a class="code" href="a00128.html#a56fa75f3eb056ae29b1a4b8da0035d8c" title="Current state of the MAC.">state</a> = IDLE;
        <a class="code" href="a00128.html#a11fb608b3564e2d2cd41b463b1a8cc90" title="Number of frame transmission attempt.">longRetryCounter</a> = 0;
        <a class="code" href="a00128.html#a9bbc3d71eddb62c4e12dcd500a58b0bb" title="Number of frame transmission attempt.">shortRetryCounter</a> = 0;
        <a class="code" href="a00128.html#a6ad4dd93415c98c969df05f53d739cfd" title="Number of bits in a packet before RTS/CTS is used.">rtsCtsThreshold</a> = hasPar(<span class="stringliteral">&quot;rtsCtsThreshold&quot;</span>) ? par(<span class="stringliteral">&quot;rtsCtsThreshold&quot;</span>).longValue() : 1;
        <a class="code" href="a00128.html#a4a9d1c8d45c46f18afa0f07f5b6572f4" title="current IFS value (DIFS or EIFS) If an error has been detected, the next backoff requires EIFS...">currentIFS</a> = EIFS;

        <a class="code" href="a00128.html#a979883a8da4b308de4a8e79b5bbbe2e6" title="Auto bit rate adaptation -- switch.">autoBitrate</a> = hasPar(<span class="stringliteral">&quot;autoBitrate&quot;</span>) ? par(<span class="stringliteral">&quot;autoBitrate&quot;</span>).boolValue() : <span class="keyword">false</span>;

        <a class="code" href="a00128.html#a592eee2a24a6fcadd6fdf912a101719f" title="The power at which data is transmitted.">txPower</a> = hasPar(<span class="stringliteral">&quot;txPower&quot;</span>) ? par(<span class="stringliteral">&quot;txPower&quot;</span>).doubleValue() : 110.11;

        <a class="code" href="a00128.html#ab9f0ea820748af6d640569fc76f39659" title="Very small value used in timer scheduling in order to avoid multiple changements of state in the same...">delta</a> = 1E-9;

        debugEV &lt;&lt; <span class="stringliteral">&quot;SIFS: &quot;</span> &lt;&lt; SIFS &lt;&lt; <span class="stringliteral">&quot; DIFS: &quot;</span> &lt;&lt; DIFS &lt;&lt; <span class="stringliteral">&quot; EIFS: &quot;</span> &lt;&lt; EIFS &lt;&lt; endl;
    }
    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(stage == 1) {
      <a class="code" href="a00019.html" title="Module to control the channel and handle all connection related stuff.">BaseConnectionManager</a>* cc = <a class="code" href="a00026.html#a68f36d36168a8ba5c8a4c84c17f1ba40" title="Returns a pointer to this MACs NICs ConnectionManager module.">getConnectionManager</a>();

      <span class="keywordflow">if</span>(cc-&gt;hasPar(<span class="stringliteral">&quot;pMax&quot;</span>) &amp;&amp; <a class="code" href="a00128.html#a592eee2a24a6fcadd6fdf912a101719f" title="The power at which data is transmitted.">txPower</a> &gt; cc-&gt;par(<span class="stringliteral">&quot;pMax&quot;</span>).doubleValue())
            opp_error(<span class="stringliteral">&quot;TranmitterPower can&#39;t be bigger than pMax in ConnectionManager! &quot;</span>
                    <span class="stringliteral">&quot;Please adjust your omnetpp.ini file accordingly.&quot;</span>);

      <span class="keywordtype">int</span> channel = <a class="code" href="a00026.html#aa7b1e6bdb734765a9f4eff7d486dfbea" title="Handler to the physical layer.">phy</a>-&gt;<a class="code" href="a00134.html#a6271dfe09bf5cef8c8afb96de00182ab" title="Returns the channel currently used by the radio.">getCurrentRadioChannel</a>();
      <span class="keywordflow">if</span>(!(1&lt;=channel &amp;&amp; channel&lt;=14)) {
        opp_error(<span class="stringliteral">&quot;MiximRadio set to invalid channel %d. Please make sure the&quot;</span>
              <span class="stringliteral">&quot; phy modules parameter \&quot;initialRadioChannel\&quot; is set to&quot;</span>
              <span class="stringliteral">&quot; a valid 802.11 channel (1 to 14)!&quot;</span>, channel);
      }
      <a class="code" href="a00128.html#a67eba657efe23f5e5c21904f4744261d" title="Stores the center frequency the Mac uses.">centerFreq</a> = CENTER_FREQUENCIES[channel];

        <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;
        <a class="code" href="a00128.html#a126c9db5a54bafa6ad74eb3ee24bd936" title="Current bit rate at which data is transmitted.">bitrate</a> = hasPar(<span class="stringliteral">&quot;bitrate&quot;</span>) ? par(<span class="stringliteral">&quot;bitrate&quot;</span>).doubleValue() : BITRATES_80211[0];
        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 4; i++) {
            <span class="keywordflow">if</span>(<a class="code" href="a00128.html#a126c9db5a54bafa6ad74eb3ee24bd936" title="Current bit rate at which data is transmitted.">bitrate</a> == BITRATES_80211[i]) {
                found = <span class="keyword">true</span>;
                <span class="keywordflow">break</span>;
            }
        }
        <span class="keywordflow">if</span>(!found) <a class="code" href="a00128.html#a126c9db5a54bafa6ad74eb3ee24bd936" title="Current bit rate at which data is transmitted.">bitrate</a> = BITRATES_80211[0];
        <a class="code" href="a00128.html#a226566e4a56cfed2928acc87ff3af90a" title="Default bitrate.">defaultBitrate</a> = <a class="code" href="a00128.html#a126c9db5a54bafa6ad74eb3ee24bd936" title="Current bit rate at which data is transmitted.">bitrate</a>;

        <a class="code" href="a00128.html#a1cd38454a518f922ba57f68d22e2f31e" title="Hold RSSI thresholds at which to change the bitrates.">snrThresholds</a>.push_back(hasPar(<span class="stringliteral">&quot;snr2Mbit&quot;</span>) ? par(<span class="stringliteral">&quot;snr2Mbit&quot;</span>).doubleValue() : 100);
        <a class="code" href="a00128.html#a1cd38454a518f922ba57f68d22e2f31e" title="Hold RSSI thresholds at which to change the bitrates.">snrThresholds</a>.push_back(hasPar(<span class="stringliteral">&quot;snr5Mbit&quot;</span>) ? par(<span class="stringliteral">&quot;snr5Mbit&quot;</span>).doubleValue() : 100);
        <a class="code" href="a00128.html#a1cd38454a518f922ba57f68d22e2f31e" title="Hold RSSI thresholds at which to change the bitrates.">snrThresholds</a>.push_back(hasPar(<span class="stringliteral">&quot;snr11Mbit&quot;</span>) ? par(<span class="stringliteral">&quot;snr11Mbit&quot;</span>).doubleValue() : 100);
        <a class="code" href="a00128.html#a1cd38454a518f922ba57f68d22e2f31e" title="Hold RSSI thresholds at which to change the bitrates.">snrThresholds</a>.push_back(111111111); <span class="comment">// sentinel</span>

        <a class="code" href="a00128.html#ae62ff2c9617e5782f6f7231e36d1574d" title="Keep information for this many neighbors.">neighborhoodCacheSize</a> = hasPar(<span class="stringliteral">&quot;neighborhoodCacheSize&quot;</span>) ? par(<span class="stringliteral">&quot;neighborhoodCacheSize&quot;</span>).longValue() : 0;
        <a class="code" href="a00128.html#aede2e9e4e32ef871e3a59c51564123de" title="Consider information in cache outdate if it is older than this.">neighborhoodCacheMaxAge</a> = hasPar(<span class="stringliteral">&quot;neighborhoodCacheMaxAge&quot;</span>) ? par(<span class="stringliteral">&quot;neighborhoodCacheMaxAge&quot;</span>).longValue() : 10000;

        debugEV &lt;&lt; <span class="stringliteral">&quot; MAC Address: &quot;</span> &lt;&lt; <a class="code" href="a00026.html#a8a26df9da07801d8ccb530530ef57ee2" title="MAC address.">myMacAddr</a>
           &lt;&lt; <span class="stringliteral">&quot; rtsCtsThreshold: &quot;</span> &lt;&lt; <a class="code" href="a00128.html#a6ad4dd93415c98c969df05f53d739cfd" title="Number of bits in a packet before RTS/CTS is used.">rtsCtsThreshold</a>
           &lt;&lt; <span class="stringliteral">&quot; bitrate: &quot;</span> &lt;&lt; <a class="code" href="a00128.html#a126c9db5a54bafa6ad74eb3ee24bd936" title="Current bit rate at which data is transmitted.">bitrate</a>
           &lt;&lt; <span class="stringliteral">&quot; channel: &quot;</span> &lt;&lt; channel
           &lt;&lt; <span class="stringliteral">&quot; autoBitrate: &quot;</span> &lt;&lt; <a class="code" href="a00128.html#a979883a8da4b308de4a8e79b5bbbe2e6" title="Auto bit rate adaptation -- switch.">autoBitrate</a>
           &lt;&lt; <span class="stringliteral">&quot; 2MBit: &quot;</span> &lt;&lt; <a class="code" href="a00128.html#a1cd38454a518f922ba57f68d22e2f31e" title="Hold RSSI thresholds at which to change the bitrates.">snrThresholds</a>[0]
           &lt;&lt; <span class="stringliteral">&quot; 5.5MBit: &quot;</span> &lt;&lt;<a class="code" href="a00128.html#a1cd38454a518f922ba57f68d22e2f31e" title="Hold RSSI thresholds at which to change the bitrates.">snrThresholds</a>[1]
           &lt;&lt; <span class="stringliteral">&quot; 11MBit: &quot;</span> &lt;&lt; <a class="code" href="a00128.html#a1cd38454a518f922ba57f68d22e2f31e" title="Hold RSSI thresholds at which to change the bitrates.">snrThresholds</a>[2]
           &lt;&lt; <span class="stringliteral">&quot; neighborhoodCacheSize &quot;</span> &lt;&lt; <a class="code" href="a00128.html#ae62ff2c9617e5782f6f7231e36d1574d" title="Keep information for this many neighbors.">neighborhoodCacheSize</a>
           &lt;&lt; <span class="stringliteral">&quot; neighborhoodCacheMaxAge &quot;</span> &lt;&lt; <a class="code" href="a00128.html#aede2e9e4e32ef871e3a59c51564123de" title="Consider information in cache outdate if it is older than this.">neighborhoodCacheMaxAge</a>
           &lt;&lt; endl;

        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) {
            <a class="code" href="a00128.html#a1cd38454a518f922ba57f68d22e2f31e" title="Hold RSSI thresholds at which to change the bitrates.">snrThresholds</a>[i] = <a class="code" href="a00095.html#af308407856d9835b103f2421e373ee28">FWMath::dBm2mW</a>(<a class="code" href="a00128.html#a1cd38454a518f922ba57f68d22e2f31e" title="Hold RSSI thresholds at which to change the bitrates.">snrThresholds</a>[i]);
        }

        <a class="code" href="a00128.html#a58484d1a6f2031548d433d18438042e9" title="remaining backoff time. If the backoff timer is interrupted, this variable holds the remaining backof...">remainingBackoff</a> = <a class="code" href="a00128.html#ade2c913df312fd4fc46106c1134889b8" title="Compute a backoff value.">backoff</a>();
        <a class="code" href="a00128.html#a59cb9e6071f33bc460a2f3a662c4bc59" title="Starts a channel sense request which sense the channel for the passed duration or until the channel i...">senseChannelWhileIdle</a>(<a class="code" href="a00128.html#a58484d1a6f2031548d433d18438042e9" title="remaining backoff time. If the backoff timer is interrupted, this variable holds the remaining backof...">remainingBackoff</a> + <a class="code" href="a00128.html#a4a9d1c8d45c46f18afa0f07f5b6572f4" title="current IFS value (DIFS or EIFS) If an error has been detected, the next backoff requires EIFS...">currentIFS</a>);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a6732e4a776e78432bf5dd9dd26de2f7d"></a><!-- doxytag: member="Mac80211::packetDuration" ref="a6732e4a776e78432bf5dd9dd26de2f7d" args="(double bits, double br)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t Mac80211::packetDuration </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>bits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>br</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>computes the duration of a transmission over the physical channel, given a certain bitrate </p>
<p>Computes the duration of the transmission of a frame over the physical channel. 'bits' should be the total length of the mac packet in bits excluding the phy header length. </p>

<p>References <a class="el" href="a00026.html#ab54fe535cdac4d9ee526153163991b4d">BaseMacLayer::phyHeaderLength</a>.</p>

<p>Referenced by <a class="el" href="a00128.html#a1c404a5176db493c2fefb71537783607">sendACKframe()</a>, <a class="el" href="a00128.html#a26b30d048980b56d79c04e859bfce009">sendBROADCASTframe()</a>, <a class="el" href="a00128.html#a1fd59a589e53facb68c13be84521a49e">sendCTSframe()</a>, <a class="el" href="a00128.html#a7a4ff22b4b999827a898794923115880">sendDATAframe()</a>, <a class="el" href="a00128.html#a3104750758ab171b20ffcfeae0079a78">sendRTSframe()</a>, and <a class="el" href="a00128.html#a424851e88bb229fcc3c59cfea80a9079">timeOut()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">return</span> bits / br + <a class="code" href="a00026.html#ab54fe535cdac4d9ee526153163991b4d" title="The length of the phy header (in bits).">phyHeaderLength</a> / BITRATE_HEADER;
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1c404a5176db493c2fefb71537783607"></a><!-- doxytag: member="Mac80211::sendACKframe" ref="a1c404a5176db493c2fefb71537783607" args="(Mac80211Pkt *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::sendACKframe </td>
          <td>(</td>
          <td class="paramtype">Mac80211Pkt *&#160;</td>
          <td class="paramname"><em>af</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>send Acknoledgement </p>
<p>Send an ACK frame.Called by HandleEndSifsTimer() </p>

<p>References <a class="el" href="a00128.html#a3a62f334346a15619853a8c6c87367aa">createSignal()</a>, <a class="el" href="a00177.html#a695fcb4091796018a3315486acafc9b0">PhyToMacControlInfo::getDeciderResult()</a>, <a class="el" href="a00026.html#a8a26df9da07801d8ccb530530ef57ee2">BaseMacLayer::myMacAddr</a>, <a class="el" href="a00128.html#a6732e4a776e78432bf5dd9dd26de2f7d">packetDuration()</a>, <a class="el" href="a00025.html#a1873d6e3fc6d92cf8482b39f1c5ac6c8">BaseLayer::sendDown()</a>, <a class="el" href="a00026.html#ab57af129814d784f2a96978f036c575a">BaseMacLayer::setDownControlInfo()</a>, <a class="el" href="a00128.html#a9fc6eb078e53740d354f8ea7b9d94713">setState()</a>, and <a class="el" href="a00128.html#a592eee2a24a6fcadd6fdf912a101719f">txPower</a>.</p>

<p>Referenced by <a class="el" href="a00128.html#a7d36a55827a7ea91b2539c86d79349af">handleEndSifsTimer()</a>.</p>
<div class="fragment"><pre class="fragment">{
    Mac80211Pkt *frame = <span class="keyword">new</span> Mac80211Pkt(<span class="stringliteral">&quot;wlan-ack&quot;</span>);

    <span class="keywordtype">double</span> br = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="a00076.html" title="Defines an extended DeciderResult for the 80211 protocol which stores the bit-rate of the transmissio...">DeciderResult80211</a>*<span class="keyword">&gt;</span>(<a class="code" href="a00177.html#a695fcb4091796018a3315486acafc9b0" title="Returns the result of the evaluation of the Decider.">PhyToMacControlInfo::getDeciderResult</a>(af))-&gt;getBitrate();
    <span class="keyword">delete</span> af-&gt;removeControlInfo();

    <a class="code" href="a00026.html#ab57af129814d784f2a96978f036c575a" title="Attaches a &quot;control info&quot; (MacToPhy) structure (object) to the message pMsg.">setDownControlInfo</a>(frame, <a class="code" href="a00128.html#a3a62f334346a15619853a8c6c87367aa" title="Creates the signal to be used for a packet to be sent.">createSignal</a>(simTime(), <a class="code" href="a00128.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain bitrate...">packetDuration</a>(LENGTH_ACK, br), <a class="code" href="a00128.html#a592eee2a24a6fcadd6fdf912a101719f" title="The power at which data is transmitted.">txPower</a>, br));
    frame-&gt;setKind(ACK);
    frame-&gt;setBitLength((<span class="keywordtype">int</span>)LENGTH_ACK);

    <span class="comment">// the dest address must be the src adress of the RTS or the DATA</span>
    <span class="comment">// packet received. The src adress is the adress of the node</span>
    frame-&gt;setSrcAddr(<a class="code" href="a00026.html#a8a26df9da07801d8ccb530530ef57ee2" title="MAC address.">myMacAddr</a>);
    frame-&gt;setDestAddr(af-&gt;getSrcAddr());
    frame-&gt;setDuration(0);

    <a class="code" href="a00025.html#a1873d6e3fc6d92cf8482b39f1c5ac6c8" title="Sends a message to the lower layer.">sendDown</a>(frame);
    debugEV &lt;&lt; <span class="stringliteral">&quot;sent ACK frame!\n&quot;</span>;

    <span class="comment">// update state and display</span>
    <a class="code" href="a00128.html#a9fc6eb078e53740d354f8ea7b9d94713" title="Sets the state, and produces a log message in between.">setState</a>(BUSY);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a26b30d048980b56d79c04e859bfce009"></a><!-- doxytag: member="Mac80211::sendBROADCASTframe" ref="a26b30d048980b56d79c04e859bfce009" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::sendBROADCASTframe </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>send broadcast frame </p>
<p>Send a BROADCAST frame.Called by handleContentionTimer() </p>

<p>References <a class="el" href="a00128.html#a3a62f334346a15619853a8c6c87367aa">createSignal()</a>, <a class="el" href="a00128.html#a969e8e3a592dffccea28596c61b2af50">fromUpperLayer</a>, <a class="el" href="a00128.html#a6732e4a776e78432bf5dd9dd26de2f7d">packetDuration()</a>, <a class="el" href="a00128.html#a7905be98b60b2a709dfbcd7e16bc761e">retrieveBitrate()</a>, <a class="el" href="a00025.html#a1873d6e3fc6d92cf8482b39f1c5ac6c8">BaseLayer::sendDown()</a>, <a class="el" href="a00026.html#ab57af129814d784f2a96978f036c575a">BaseMacLayer::setDownControlInfo()</a>, <a class="el" href="a00128.html#a9fc6eb078e53740d354f8ea7b9d94713">setState()</a>, and <a class="el" href="a00128.html#a592eee2a24a6fcadd6fdf912a101719f">txPower</a>.</p>

<p>Referenced by <a class="el" href="a00128.html#a0a87fa1791117ef1dd1841ba217e4245">handleEndContentionTimer()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="comment">// send a copy of the frame in front of the queue</span>
    Mac80211Pkt *frame = <span class="keyword">static_cast&lt;</span>Mac80211Pkt *<span class="keyword">&gt;</span>(<a class="code" href="a00128.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.front()-&gt;dup());

    <span class="keywordtype">double</span> br = <a class="code" href="a00128.html#a7905be98b60b2a709dfbcd7e16bc761e" title="figure out at which bitrate to send to this particular destination">retrieveBitrate</a>(frame-&gt;getDestAddr());

    simtime_t duration = <a class="code" href="a00128.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain bitrate...">packetDuration</a>(frame-&gt;getBitLength(), br);
    <a class="code" href="a00026.html#ab57af129814d784f2a96978f036c575a" title="Attaches a &quot;control info&quot; (MacToPhy) structure (object) to the message pMsg.">setDownControlInfo</a>(frame, <a class="code" href="a00128.html#a3a62f334346a15619853a8c6c87367aa" title="Creates the signal to be used for a packet to be sent.">createSignal</a>(simTime(), duration, <a class="code" href="a00128.html#a592eee2a24a6fcadd6fdf912a101719f" title="The power at which data is transmitted.">txPower</a>, br));

    frame-&gt;setKind(BROADCAST);

    <a class="code" href="a00025.html#a1873d6e3fc6d92cf8482b39f1c5ac6c8" title="Sends a message to the lower layer.">sendDown</a>(frame);
    <span class="comment">// update state and display</span>
    <a class="code" href="a00128.html#a9fc6eb078e53740d354f8ea7b9d94713" title="Sets the state, and produces a log message in between.">setState</a>(BUSY);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a1fd59a589e53facb68c13be84521a49e"></a><!-- doxytag: member="Mac80211::sendCTSframe" ref="a1fd59a589e53facb68c13be84521a49e" args="(Mac80211Pkt *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::sendCTSframe </td>
          <td>(</td>
          <td class="paramtype">Mac80211Pkt *&#160;</td>
          <td class="paramname"><em>af</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>send CTS frame </p>
<p>Send a CTS frame.Called by HandleEndSifsTimer() </p>

<p>References <a class="el" href="a00128.html#a3a62f334346a15619853a8c6c87367aa">createSignal()</a>, <a class="el" href="a00177.html#a695fcb4091796018a3315486acafc9b0">PhyToMacControlInfo::getDeciderResult()</a>, <a class="el" href="a00026.html#a8a26df9da07801d8ccb530530ef57ee2">BaseMacLayer::myMacAddr</a>, <a class="el" href="a00128.html#a6732e4a776e78432bf5dd9dd26de2f7d">packetDuration()</a>, <a class="el" href="a00025.html#a1873d6e3fc6d92cf8482b39f1c5ac6c8">BaseLayer::sendDown()</a>, <a class="el" href="a00026.html#ab57af129814d784f2a96978f036c575a">BaseMacLayer::setDownControlInfo()</a>, <a class="el" href="a00128.html#a9fc6eb078e53740d354f8ea7b9d94713">setState()</a>, and <a class="el" href="a00128.html#a592eee2a24a6fcadd6fdf912a101719f">txPower</a>.</p>

<p>Referenced by <a class="el" href="a00128.html#a7d36a55827a7ea91b2539c86d79349af">handleEndSifsTimer()</a>.</p>
<div class="fragment"><pre class="fragment">{
    Mac80211Pkt *frame = <span class="keyword">new</span> Mac80211Pkt(<span class="stringliteral">&quot;wlan-cts&quot;</span>);

    <span class="keywordtype">double</span> br = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="a00076.html" title="Defines an extended DeciderResult for the 80211 protocol which stores the bit-rate of the transmissio...">DeciderResult80211</a>*<span class="keyword">&gt;</span>(<a class="code" href="a00177.html#a695fcb4091796018a3315486acafc9b0" title="Returns the result of the evaluation of the Decider.">PhyToMacControlInfo::getDeciderResult</a>(af))-&gt;getBitrate();
    <span class="keyword">delete</span> af-&gt;removeControlInfo();

    <a class="code" href="a00026.html#ab57af129814d784f2a96978f036c575a" title="Attaches a &quot;control info&quot; (MacToPhy) structure (object) to the message pMsg.">setDownControlInfo</a>(frame, <a class="code" href="a00128.html#a3a62f334346a15619853a8c6c87367aa" title="Creates the signal to be used for a packet to be sent.">createSignal</a>(simTime(), <a class="code" href="a00128.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain bitrate...">packetDuration</a>(LENGTH_CTS, br), <a class="code" href="a00128.html#a592eee2a24a6fcadd6fdf912a101719f" title="The power at which data is transmitted.">txPower</a>, br));

    frame-&gt;setKind(CTS);
    frame-&gt;setBitLength((<span class="keywordtype">int</span>)LENGTH_CTS);

    <span class="comment">// the dest adress must be the src adress of the RTS received. The</span>
    <span class="comment">// src adress is the adress of the node</span>
    frame-&gt;setSrcAddr(<a class="code" href="a00026.html#a8a26df9da07801d8ccb530530ef57ee2" title="MAC address.">myMacAddr</a>);
    frame-&gt;setDestAddr(af-&gt;getSrcAddr());

    frame-&gt;setDuration(af-&gt;getDuration() - SIFS - <a class="code" href="a00128.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain bitrate...">packetDuration</a>(LENGTH_CTS, br));

    <span class="comment">//scheduleAt(simTime() + af-&gt;getDuration() - packetDuration(LENGTH_ACK, br) - 2 * SIFS + delta, timeout);</span>
    debugEV &lt;&lt; <span class="stringliteral">&quot; Mac80211::sendCTSframe duration: &quot;</span> &lt;&lt;  <a class="code" href="a00128.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain bitrate...">packetDuration</a>(LENGTH_CTS, br) &lt;&lt; <span class="stringliteral">&quot; br: &quot;</span> &lt;&lt; br &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
    <span class="comment">// send CTS frame</span>
    <a class="code" href="a00025.html#a1873d6e3fc6d92cf8482b39f1c5ac6c8" title="Sends a message to the lower layer.">sendDown</a>(frame);

    <span class="comment">// update state and display</span>
    <a class="code" href="a00128.html#a9fc6eb078e53740d354f8ea7b9d94713" title="Sets the state, and produces a log message in between.">setState</a>(WFDATA);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a7a4ff22b4b999827a898794923115880"></a><!-- doxytag: member="Mac80211::sendDATAframe" ref="a7a4ff22b4b999827a898794923115880" args="(Mac80211Pkt *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::sendDATAframe </td>
          <td>(</td>
          <td class="paramtype">Mac80211Pkt *&#160;</td>
          <td class="paramname"><em>af</em></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>send data frame </p>
<p>Send a DATA frame. Called by HandleEndSifsTimer() or <a class="el" href="a00128.html#a0a87fa1791117ef1dd1841ba217e4245" title="handle end of contention">handleEndContentionTimer()</a> </p>

<p>References <a class="el" href="a00128.html#a3a62f334346a15619853a8c6c87367aa">createSignal()</a>, <a class="el" href="a00128.html#a969e8e3a592dffccea28596c61b2af50">fromUpperLayer</a>, <a class="el" href="a00177.html#a695fcb4091796018a3315486acafc9b0">PhyToMacControlInfo::getDeciderResult()</a>, <a class="el" href="a00026.html#a8a26df9da07801d8ccb530530ef57ee2">BaseMacLayer::myMacAddr</a>, <a class="el" href="a00128.html#a6732e4a776e78432bf5dd9dd26de2f7d">packetDuration()</a>, <a class="el" href="a00128.html#a7905be98b60b2a709dfbcd7e16bc761e">retrieveBitrate()</a>, <a class="el" href="a00025.html#a1873d6e3fc6d92cf8482b39f1c5ac6c8">BaseLayer::sendDown()</a>, <a class="el" href="a00026.html#ab57af129814d784f2a96978f036c575a">BaseMacLayer::setDownControlInfo()</a>, <a class="el" href="a00128.html#a9fc6eb078e53740d354f8ea7b9d94713">setState()</a>, <a class="el" href="a00128.html#a9bbc3d71eddb62c4e12dcd500a58b0bb">shortRetryCounter</a>, <a class="el" href="a00128.html#a424851e88bb229fcc3c59cfea80a9079">timeOut()</a>, <a class="el" href="a00128.html#a2d31f97b0662b8e37f090c3b996cec82">timeout</a>, and <a class="el" href="a00128.html#a592eee2a24a6fcadd6fdf912a101719f">txPower</a>.</p>

<p>Referenced by <a class="el" href="a00128.html#a0a87fa1791117ef1dd1841ba217e4245">handleEndContentionTimer()</a>, and <a class="el" href="a00128.html#a7d36a55827a7ea91b2539c86d79349af">handleEndSifsTimer()</a>.</p>
<div class="fragment"><pre class="fragment">{
    Mac80211Pkt *frame = <span class="keyword">static_cast&lt;</span>Mac80211Pkt *<span class="keyword">&gt;</span>(<a class="code" href="a00128.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.front()-&gt;dup());
    <span class="keywordtype">double</span> br;

    <span class="keywordflow">if</span>(af) {
        br = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="a00076.html" title="Defines an extended DeciderResult for the 80211 protocol which stores the bit-rate of the transmissio...">DeciderResult80211</a>*<span class="keyword">&gt;</span>(<a class="code" href="a00177.html#a695fcb4091796018a3315486acafc9b0" title="Returns the result of the evaluation of the Decider.">PhyToMacControlInfo::getDeciderResult</a>(af))-&gt;getBitrate();

        <span class="keyword">delete</span> af-&gt;removeControlInfo();
    }
    <span class="keywordflow">else</span> {
       br  = <a class="code" href="a00128.html#a7905be98b60b2a709dfbcd7e16bc761e" title="figure out at which bitrate to send to this particular destination">retrieveBitrate</a>(frame-&gt;getDestAddr());

       <span class="keywordflow">if</span>(<a class="code" href="a00128.html#a9bbc3d71eddb62c4e12dcd500a58b0bb" title="Number of frame transmission attempt.">shortRetryCounter</a>) frame-&gt;setRetry(<span class="keyword">true</span>);
    }
    simtime_t duration = <a class="code" href="a00128.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain bitrate...">packetDuration</a>(frame-&gt;getBitLength(), br);
    <a class="code" href="a00026.html#ab57af129814d784f2a96978f036c575a" title="Attaches a &quot;control info&quot; (MacToPhy) structure (object) to the message pMsg.">setDownControlInfo</a>(frame, <a class="code" href="a00128.html#a3a62f334346a15619853a8c6c87367aa" title="Creates the signal to be used for a packet to be sent.">createSignal</a>(simTime(), duration, <a class="code" href="a00128.html#a592eee2a24a6fcadd6fdf912a101719f" title="The power at which data is transmitted.">txPower</a>, br));
    <span class="comment">// build a copy of the frame in front of the queue&#39;</span>
    frame-&gt;setSrcAddr(<a class="code" href="a00026.html#a8a26df9da07801d8ccb530530ef57ee2" title="MAC address.">myMacAddr</a>);
    frame-&gt;setKind(DATA);
    frame-&gt;setDuration(SIFS + <a class="code" href="a00128.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain bitrate...">packetDuration</a>(LENGTH_ACK, br));

    <span class="comment">// schedule time out</span>
    scheduleAt(simTime() + <a class="code" href="a00128.html#a424851e88bb229fcc3c59cfea80a9079" title="return a timeOut value for a certain type of frame">timeOut</a>(DATA, br), <a class="code" href="a00128.html#a2d31f97b0662b8e37f090c3b996cec82" title="Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet.">timeout</a>);
    debugEV &lt;&lt; <span class="stringliteral">&quot;sending DATA  to &quot;</span> &lt;&lt; frame-&gt;getDestAddr() &lt;&lt; <span class="stringliteral">&quot; with bitrate &quot;</span> &lt;&lt; br &lt;&lt; endl;
    <span class="comment">// send DATA frame</span>
    <a class="code" href="a00025.html#a1873d6e3fc6d92cf8482b39f1c5ac6c8" title="Sends a message to the lower layer.">sendDown</a>(frame);

    <span class="comment">// update state and display</span>
    <a class="code" href="a00128.html#a9fc6eb078e53740d354f8ea7b9d94713" title="Sets the state, and produces a log message in between.">setState</a>(WFACK);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a3104750758ab171b20ffcfeae0079a78"></a><!-- doxytag: member="Mac80211::sendRTSframe" ref="a3104750758ab171b20ffcfeae0079a78" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::sendRTSframe </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>send RTS frame </p>
<p>Send a RTS frame.Called by handleContentionTimer() </p>

<p>References <a class="el" href="a00128.html#a3a62f334346a15619853a8c6c87367aa">createSignal()</a>, <a class="el" href="a00128.html#a969e8e3a592dffccea28596c61b2af50">fromUpperLayer</a>, <a class="el" href="a00128.html#a6732e4a776e78432bf5dd9dd26de2f7d">packetDuration()</a>, <a class="el" href="a00128.html#a7905be98b60b2a709dfbcd7e16bc761e">retrieveBitrate()</a>, <a class="el" href="a00025.html#a1873d6e3fc6d92cf8482b39f1c5ac6c8">BaseLayer::sendDown()</a>, <a class="el" href="a00026.html#ab57af129814d784f2a96978f036c575a">BaseMacLayer::setDownControlInfo()</a>, <a class="el" href="a00128.html#a9fc6eb078e53740d354f8ea7b9d94713">setState()</a>, <a class="el" href="a00128.html#a424851e88bb229fcc3c59cfea80a9079">timeOut()</a>, <a class="el" href="a00128.html#a2d31f97b0662b8e37f090c3b996cec82">timeout</a>, and <a class="el" href="a00128.html#a592eee2a24a6fcadd6fdf912a101719f">txPower</a>.</p>

<p>Referenced by <a class="el" href="a00128.html#a0a87fa1791117ef1dd1841ba217e4245">handleEndContentionTimer()</a>.</p>
<div class="fragment"><pre class="fragment">{
    Mac80211Pkt *frame = <span class="keyword">new</span> Mac80211Pkt(<span class="stringliteral">&quot;wlan-rts&quot;</span>);

    <span class="keyword">const</span> Mac80211Pkt* frameToSend = <a class="code" href="a00128.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.front();
    <span class="keywordtype">double</span> br = <a class="code" href="a00128.html#a7905be98b60b2a709dfbcd7e16bc761e" title="figure out at which bitrate to send to this particular destination">retrieveBitrate</a>(frameToSend-&gt;getDestAddr());

    <a class="code" href="a00026.html#ab57af129814d784f2a96978f036c575a" title="Attaches a &quot;control info&quot; (MacToPhy) structure (object) to the message pMsg.">setDownControlInfo</a>(frame, <a class="code" href="a00128.html#a3a62f334346a15619853a8c6c87367aa" title="Creates the signal to be used for a packet to be sent.">createSignal</a>(simTime(),<a class="code" href="a00128.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain bitrate...">packetDuration</a>(LENGTH_RTS, br), <a class="code" href="a00128.html#a592eee2a24a6fcadd6fdf912a101719f" title="The power at which data is transmitted.">txPower</a>, br));

    frame-&gt;setKind(RTS);
    frame-&gt;setBitLength((<span class="keywordtype">int</span>)LENGTH_RTS);

    <span class="comment">// the src adress and dest address are copied in the frame in the queue (frame to be sent)</span>
    frame-&gt;setSrcAddr(frameToSend-&gt;getSrcAddr());
    frame-&gt;setDestAddr(frameToSend-&gt;getDestAddr());

    <span class="keywordtype">double</span> packetSize = frameToSend-&gt;getBitLength();
    frame-&gt;setDuration(3 * SIFS + <a class="code" href="a00128.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain bitrate...">packetDuration</a>(LENGTH_CTS, br) +
                       <a class="code" href="a00128.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain bitrate...">packetDuration</a>(packetSize, br) +
                       <a class="code" href="a00128.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain bitrate...">packetDuration</a>(LENGTH_ACK, br));

    debugEV &lt;&lt; <span class="stringliteral">&quot; Mac80211::sendRTSframe duration: &quot;</span> &lt;&lt;  <a class="code" href="a00128.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain bitrate...">packetDuration</a>(LENGTH_RTS, br) &lt;&lt; <span class="stringliteral">&quot; br: &quot;</span> &lt;&lt; br &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;

    <span class="comment">// schedule time-out</span>
    scheduleAt(simTime() + <a class="code" href="a00128.html#a424851e88bb229fcc3c59cfea80a9079" title="return a timeOut value for a certain type of frame">timeOut</a>(RTS, br), <a class="code" href="a00128.html#a2d31f97b0662b8e37f090c3b996cec82" title="Timer used for time-outs after the transmission of a RTS, a CTS, or a DATA packet.">timeout</a>);

    <span class="comment">// send RTS frame</span>
    <a class="code" href="a00025.html#a1873d6e3fc6d92cf8482b39f1c5ac6c8" title="Sends a message to the lower layer.">sendDown</a>(frame);

    <span class="comment">// update state and display</span>
    <a class="code" href="a00128.html#a9fc6eb078e53740d354f8ea7b9d94713" title="Sets the state, and produces a log message in between.">setState</a>(WFCTS);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a59cb9e6071f33bc460a2f3a662c4bc59"></a><!-- doxytag: member="Mac80211::senseChannelWhileIdle" ref="a59cb9e6071f33bc460a2f3a662c4bc59" args="(simtime_t_cref duration)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::senseChannelWhileIdle </td>
          <td>(</td>
          <td class="paramtype">simtime_t_cref&#160;</td>
          <td class="paramname"><em>duration</em></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Starts a channel sense request which sense the channel for the passed duration or until the channel is busy. </p>
<p>Used during contend state to check if the channel is free. </p>

<p>References <a class="el" href="a00128.html#a8104daf3041394b73fe545427cbc02d7">chSenseStart</a>, <a class="el" href="a00128.html#a7bd4f3adc205b150f9fa406fa582f0b6">contention</a>, and <a class="el" href="a00025.html#a6d01a0f56978740d7617c2e338858cc3">BaseLayer::sendControlDown()</a>.</p>

<p>Referenced by <a class="el" href="a00128.html#ab3030c86acac78401f877a61cefcdad6">beginNewCycle()</a>, and <a class="el" href="a00128.html#ab81dae24d79c2ef010301e2c219966c1">initialize()</a>.</p>
<div class="fragment"><pre class="fragment">                                                            {
  <span class="keywordflow">if</span>(<a class="code" href="a00128.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>-&gt;isScheduled()) {
    error(<span class="stringliteral">&quot;Cannot start a new channel sense request because already sensing the channel!&quot;</span>);
  }

  <a class="code" href="a00128.html#a8104daf3041394b73fe545427cbc02d7" title="Stores the the time a channel sensing started. Used to calculate the quiet-time of the channel if the...">chSenseStart</a> = simTime();
  <a class="code" href="a00128.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>-&gt;setSenseTimeout(duration);

  <a class="code" href="a00025.html#a6d01a0f56978740d7617c2e338858cc3" title="Sends a control message to a lower layer.">sendControlDown</a>(<a class="code" href="a00128.html#a7bd4f3adc205b150f9fa406fa582f0b6" title="Used to sense if the channel is idle for contention periods.">contention</a>);
}
</pre></div>
</div>
</div>
<a class="anchor" id="a72e78257babff863ca8749b2bb1a97f4"></a><!-- doxytag: member="Mac80211::testMaxAttempts" ref="a72e78257babff863ca8749b2bb1a97f4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mac80211::testMaxAttempts </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Test if maximum number of retries to transmit is exceeded. </p>
<p>Test if the maximal retry limit is reached, and delete the frame to send in this case. </p>

<p>References <a class="el" href="a00128.html#a969e8e3a592dffccea28596c61b2af50">fromUpperLayer</a>, <a class="el" href="a00128.html#a11fb608b3564e2d2cd41b463b1a8cc90">longRetryCounter</a>, <a class="el" href="a00026.html#a49e0e548a6c20d002bd67afa7b76c483adebf9c77bbe6f19772866cccbef0fe4b">BaseMacLayer::PACKET_DROPPED</a>, <a class="el" href="a00025.html#aa1190a06fb4dfb15d8ff001468335dc8">BaseLayer::sendControlUp()</a>, and <a class="el" href="a00128.html#a9bbc3d71eddb62c4e12dcd500a58b0bb">shortRetryCounter</a>.</p>

<p>Referenced by <a class="el" href="a00128.html#ab3030c86acac78401f877a61cefcdad6">beginNewCycle()</a>.</p>
<div class="fragment"><pre class="fragment">{
    <span class="keywordflow">if</span> ((<a class="code" href="a00128.html#a11fb608b3564e2d2cd41b463b1a8cc90" title="Number of frame transmission attempt.">longRetryCounter</a> &gt;= LONG_RETRY_LIMIT) || (<a class="code" href="a00128.html#a9bbc3d71eddb62c4e12dcd500a58b0bb" title="Number of frame transmission attempt.">shortRetryCounter</a> &gt;= SHORT_RETRY_LIMIT)) {
      debugEV &lt;&lt; <span class="stringliteral">&quot;retry limit reached src: &quot;</span>&lt;&lt; <a class="code" href="a00128.html#a9bbc3d71eddb62c4e12dcd500a58b0bb" title="Number of frame transmission attempt.">shortRetryCounter</a> &lt;&lt; <span class="stringliteral">&quot; lrc: &quot;</span> &lt;&lt; <a class="code" href="a00128.html#a11fb608b3564e2d2cd41b463b1a8cc90" title="Number of frame transmission attempt.">longRetryCounter</a> &lt;&lt; endl;
        <span class="comment">// initialize counter</span>
        <a class="code" href="a00128.html#a11fb608b3564e2d2cd41b463b1a8cc90" title="Number of frame transmission attempt.">longRetryCounter</a> = 0;
        <a class="code" href="a00128.html#a9bbc3d71eddb62c4e12dcd500a58b0bb" title="Number of frame transmission attempt.">shortRetryCounter</a> = 0;
        <span class="comment">// delete the frame to transmit</span>
        Mac80211Pkt *temp = <a class="code" href="a00128.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.front();
        <a class="code" href="a00128.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.pop_front();
        temp-&gt;setName(<span class="stringliteral">&quot;MAC ERROR&quot;</span>);
        temp-&gt;setKind(<a class="code" href="a00026.html#a49e0e548a6c20d002bd67afa7b76c483adebf9c77bbe6f19772866cccbef0fe4b">PACKET_DROPPED</a>);
        <a class="code" href="a00025.html#aa1190a06fb4dfb15d8ff001468335dc8" title="Sends a control message to an upper layer.">sendControlUp</a>(temp);
    }
}
</pre></div>
</div>
</div>
<a class="anchor" id="a424851e88bb229fcc3c59cfea80a9079"></a><!-- doxytag: member="Mac80211::timeOut" ref="a424851e88bb229fcc3c59cfea80a9079" args="(Mac80211MessageKinds type, double br)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simtime_t Mac80211::timeOut </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00128.html#ae423db101e8431b0cbd67c347076c44a">Mac80211MessageKinds</a>&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>br</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>return a timeOut value for a certain type of frame </p>
<p>Return a time-out value for a type of frame. Called by SendRTSframe, sendCTSframe, etc. </p>

<p>References <a class="el" href="a00128.html#ab9f0ea820748af6d640569fc76f39659">delta</a>, <a class="el" href="a00128.html#a969e8e3a592dffccea28596c61b2af50">fromUpperLayer</a>, and <a class="el" href="a00128.html#a6732e4a776e78432bf5dd9dd26de2f7d">packetDuration()</a>.</p>

<p>Referenced by <a class="el" href="a00128.html#a7a4ff22b4b999827a898794923115880">sendDATAframe()</a>, and <a class="el" href="a00128.html#a3104750758ab171b20ffcfeae0079a78">sendRTSframe()</a>.</p>
<div class="fragment"><pre class="fragment">{
    simtime_t time_out = 0;

    <span class="keywordflow">switch</span> (type)
    {
    <span class="keywordflow">case</span> RTS:
        time_out = SIFS + <a class="code" href="a00128.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain bitrate...">packetDuration</a>(LENGTH_RTS, br) + ST + <a class="code" href="a00128.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain bitrate...">packetDuration</a>(LENGTH_CTS, br) + <a class="code" href="a00128.html#ab9f0ea820748af6d640569fc76f39659" title="Very small value used in timer scheduling in order to avoid multiple changements of state in the same...">delta</a>;
        debugEV &lt;&lt; <span class="stringliteral">&quot; Mac80211::timeOut RTS &quot;</span> &lt;&lt; time_out &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
        <span class="keywordflow">break</span>;
    <span class="keywordflow">case</span> DATA:
        time_out = SIFS + <a class="code" href="a00128.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain bitrate...">packetDuration</a>(<a class="code" href="a00128.html#a969e8e3a592dffccea28596c61b2af50" title="Buffering of messages from upper layer.">fromUpperLayer</a>.front()-&gt;getBitLength(), br) + ST + <a class="code" href="a00128.html#a6732e4a776e78432bf5dd9dd26de2f7d" title="computes the duration of a transmission over the physical channel, given a certain bitrate...">packetDuration</a>(LENGTH_ACK, br) + <a class="code" href="a00128.html#ab9f0ea820748af6d640569fc76f39659" title="Very small value used in timer scheduling in order to avoid multiple changements of state in the same...">delta</a>;
        debugEV &lt;&lt; <span class="stringliteral">&quot; Mac80211::timeOut DATA &quot;</span> &lt;&lt; time_out &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
        <span class="keywordflow">break</span>;
    <span class="keywordflow">default</span>:
        EV &lt;&lt; <span class="stringliteral">&quot;Unused frame type was given when calling timeOut(), this should not happen!\n&quot;</span>;
        <span class="keywordflow">break</span>;
    }
    <span class="keywordflow">return</span> time_out;
}
</pre></div>
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a226566e4a56cfed2928acc87ff3af90a"></a><!-- doxytag: member="Mac80211::defaultBitrate" ref="a226566e4a56cfed2928acc87ff3af90a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double <a class="el" href="a00128.html#a226566e4a56cfed2928acc87ff3af90a">Mac80211::defaultBitrate</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Default bitrate. </p>
<p>The default bitrate must be set in the omnetpp.ini. It is used whenever an auto bitrate is not appropriate, like broadcasts. </p>

<p>Referenced by <a class="el" href="a00128.html#ab81dae24d79c2ef010301e2c219966c1">initialize()</a>, and <a class="el" href="a00128.html#a7905be98b60b2a709dfbcd7e16bc761e">retrieveBitrate()</a>.</p>

</div>
</div>
<a class="anchor" id="a026837b7167d230bbe79a1e0630c7578"></a><!-- doxytag: member="Mac80211::fsc" ref="a026837b7167d230bbe79a1e0630c7578" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="a00128.html#a026837b7167d230bbe79a1e0630c7578">Mac80211::fsc</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>sequence control -- to detect duplicates </p>

<p>Referenced by <a class="el" href="a00128.html#a23738e3ef2aa14da9dbdcb3d0abbf4e2">encapsMsg()</a>, and <a class="el" href="a00128.html#ab81dae24d79c2ef010301e2c219966c1">initialize()</a>.</p>

</div>
</div>
<a class="anchor" id="a11fb608b3564e2d2cd41b463b1a8cc90"></a><!-- doxytag: member="Mac80211::longRetryCounter" ref="a11fb608b3564e2d2cd41b463b1a8cc90" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned <a class="el" href="a00128.html#a11fb608b3564e2d2cd41b463b1a8cc90">Mac80211::longRetryCounter</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Number of frame transmission attempt. </p>
<p>Incremented when the SHORT_RETRY_LIMIT is hit, or when an ACK or CTS is missing. </p>

<p>Referenced by <a class="el" href="a00128.html#ade2c913df312fd4fc46106c1134889b8">backoff()</a>, <a class="el" href="a00128.html#a50cb85360462eb7d256ec8a0b493ca44">handleACKframe()</a>, <a class="el" href="a00128.html#afe4300147d9ea5e4d3e3d8c98ff20436">handleEndTransmission()</a>, <a class="el" href="a00128.html#a0377ddefba33b8d50c7bf4045354d7bb">handleMsgNotForMe()</a>, <a class="el" href="a00128.html#ab81dae24d79c2ef010301e2c219966c1">initialize()</a>, <a class="el" href="a00128.html#a7905be98b60b2a709dfbcd7e16bc761e">retrieveBitrate()</a>, and <a class="el" href="a00128.html#a72e78257babff863ca8749b2bb1a97f4">testMaxAttempts()</a>.</p>

</div>
</div>
<a class="anchor" id="a9f9f566e85a76f63e63b5907bf9ad48a"></a><!-- doxytag: member="Mac80211::switching" ref="a9f9f566e85a76f63e63b5907bf9ad48a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="a00128.html#a9f9f566e85a76f63e63b5907bf9ad48a">Mac80211::switching</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>take care of switchover times </p>

<p>Referenced by <a class="el" href="a00128.html#adfcf8b7a5e1db233a1bd717cecaf49bd">handleBroadcastMsg()</a>, <a class="el" href="a00128.html#aa0b767642d86d3b66f1d3258065fe5ae">handleMsgForMe()</a>, and <a class="el" href="a00128.html#ab81dae24d79c2ef010301e2c219966c1">initialize()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>D:/Projects/MiXiM/extsrc/mixim/src/modules/mac/<a class="el" href="a00434_source.html">Mac80211.h</a></li>
<li>D:/Projects/MiXiM/extsrc/mixim/src/modules/mac/Mac80211.cc</li>
</ul>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="a00128.html">Mac80211</a>      </li>

    <li class="footer">Generated on Tue Mar 5 2013 21:26:32 for MiXiM by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.5.1 </li>
   </ul>
 </div>


</body>
</html>
